# fmridataset ![](reference/figures/logo.png)

## Overview

`fmridataset` provides a unified framework for representing functional
magnetic resonance imaging (fMRI) data from various sources. The package
supports multiple data backends and offers a consistent interface for
working with fMRI datasets regardless of their underlying storage
format.

## Features

- **Unified Interface**: Work with fMRI data from NIfTI files, BIDS
  projects, pre-loaded NeuroVec objects, and in-memory matrices through
  a single API
- **Lazy Loading**: Efficient memory management with on-demand data
  loading
- **Flexible Backends**: Pluggable storage backends for different data
  formats
- **Data Chunking**: Built-in support for processing large datasets in
  chunks
- **Temporal Structure**: Rich sampling frame representation for run
  lengths, TR, and temporal organization
- **Integration Ready**: Seamlessly integrates with neuroimaging
  analysis workflows

## Installation

You can install the development version of fmridataset from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("bbuchsbaum/fmridataset")
```

## Quick Start

### Creating Datasets

``` r
library(fmridataset)

# From NIfTI files
dataset <- fmri_dataset(
  scans = c("run1.nii", "run2.nii"),
  mask = "mask.nii", 
  TR = 2.0,
  run_length = c(240, 240)
)

# From in-memory matrix
mat_data <- matrix(rnorm(1000), nrow = 100, ncol = 10)
dataset <- matrix_dataset(
  datamat = mat_data,
  TR = 1.5, 
  run_length = 100
)

# From pre-loaded NeuroVec objects  
dataset <- fmri_mem_dataset(
  scans = list(neurovec1, neurovec2),
  mask = mask_vol,
  TR = 2.0
)
```

### Data Access

``` r
# Get full data matrix
data_matrix <- get_data_matrix(dataset)

# Get spatial mask
mask <- get_mask(dataset)

# Access temporal properties
n_timepoints(dataset$sampling_frame)
n_runs(dataset$sampling_frame)
get_TR(dataset$sampling_frame)
```

### Data Chunking

``` r
# Process data in chunks
chunks <- data_chunks(dataset, nchunks = 5)
for (i in 1:5) {
  chunk <- chunks$nextElem()
  # Process chunk$data, chunk$voxel_ind, etc.
}

# Run-wise processing
run_chunks <- data_chunks(dataset, runwise = TRUE)
run1_data <- run_chunks$nextElem()
```

### Type Conversions

``` r
# Convert to matrix format
mat_dataset <- as.matrix_dataset(dataset)

# All dataset types support the same interface
print(dataset)
summary(dataset$sampling_frame)
```

## Architecture

The package uses a modular architecture with the following key
components:

- **Storage Backends**: Pluggable data access layer (`matrix_backend`,
  `nifti_backend`)
- **Dataset Constructors**: High-level dataset creation functions
- **Sampling Frames**: Temporal structure representation
- **Data Access Methods**: Consistent interface for data retrieval
- **Chunking System**: Efficient processing of large datasets

## Related Packages

- [`neuroim2`](https://github.com/bbuchsbaum/neuroim2): Neuroimaging
  data structures
- [`fmristore`](https://github.com/bbuchsbaum/fmristore): Advanced fMRI
  data storage
- [`bidser`](https://github.com/bbuchsbaum/bidser): BIDS dataset
  utilities

## Getting Help

- Check the [package
  documentation](https://bbuchsbaum.github.io/fmridataset/) for detailed
  guides
- Report bugs or request features on [GitHub
  Issues](https://github.com/bbuchsbaum/fmridataset/issues)
- See the
  [vignettes](https://bbuchsbaum.github.io/fmridataset/articles/) for
  detailed examples

## Contributing

Contributions are welcome! Please see our [Contributing
Guide](https://bbuchsbaum.github.io/fmridataset/CONTRIBUTING.md) for
details.

## License

GPL (\>= 3)

# Package index

## All functions

- [`all_selector()`](https://bbuchsbaum.github.io/fmridataset/reference/all_selector.md)
  : All Voxels Series Selector

- [`as.matrix(`*`<fmri_series>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/as.matrix.fmri_series.md)
  : Convert fmri_series to Matrix

- [`as.matrix_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/as.matrix_dataset.md)
  : Convert to Matrix Dataset

- [`as_delarr()`](https://bbuchsbaum.github.io/fmridataset/reference/as_delarr.md)
  : Convert backend to a delarr lazy matrix

- [`as_delayed_array(`*`<matrix_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/as_delayed_array-dataset.md)
  [`as_delayed_array(`*`<fmri_file_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/as_delayed_array-dataset.md)
  [`as_delayed_array(`*`<fmri_mem_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/as_delayed_array-dataset.md)
  : Convert Dataset Objects to DelayedArray

- [`as_delayed_array()`](https://bbuchsbaum.github.io/fmridataset/reference/as_delayed_array.md)
  : Convert Backend to DelayedArray

- [`as_fmri_group()`](https://bbuchsbaum.github.io/fmridataset/reference/as_fmri_group.md)
  : Coerce a data frame into an fmri_group

- [`as_tibble(`*`<fmri_series>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/as_tibble.fmri_series.md)
  : Convert fmri_series to Tibble

- [`as_tibble(`*`<fmri_study_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/as_tibble.fmri_study_dataset.md)
  : Convert fmri_study_dataset to a tibble or lazy matrix

- [`blockids()`](https://bbuchsbaum.github.io/fmridataset/reference/blockids.md)
  : Get Block IDs from Sampling Frame

- [`blocklens()`](https://bbuchsbaum.github.io/fmridataset/reference/blocklens.md)
  : Get Block Lengths from Objects

- [`collect_chunks()`](https://bbuchsbaum.github.io/fmridataset/reference/collect_chunks.md)
  : Collect all chunks from a chunk iterator

- [`create_backend()`](https://bbuchsbaum.github.io/fmridataset/reference/create_backend.md)
  : Create Backend Instance

- [`data_chunk()`](https://bbuchsbaum.github.io/fmridataset/reference/data_chunk.md)
  : Create a Data Chunk Object

- [`data_chunks()`](https://bbuchsbaum.github.io/fmridataset/reference/data_chunks.md)
  : Create Data Chunks for Processing

- [`data_chunks(`*`<fmri_file_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/data_chunks.fmri_file_dataset.md)
  : Create Data Chunks for fmri_file_dataset Objects

- [`data_chunks(`*`<fmri_mem_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/data_chunks.fmri_mem_dataset.md)
  : Create Data Chunks for fmri_mem_dataset Objects

- [`data_chunks(`*`<matrix_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/data_chunks.matrix_dataset.md)
  : Create Data Chunks for matrix_dataset Objects

- [`dim(`*`<fmri_series>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/dim.fmri_series.md)
  : Dimensions of fmri_series

- [`exec_strategy()`](https://bbuchsbaum.github.io/fmridataset/reference/exec_strategy.md)
  : Create an Execution Strategy for Data Processing

- [`filter_subjects()`](https://bbuchsbaum.github.io/fmridataset/reference/filter_subjects.md)
  : Filter subjects in an fmri_group

- [`fmri_cache_info()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_cache_info.md)
  : Get cache information and statistics

- [`fmri_cache_resize()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_cache_resize.md)
  : Resize the fmridataset cache

- [`fmri_clear_cache()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_clear_cache.md)
  : Clear fmridataset cache

- [`fmri_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_dataset.md)
  : Create an fMRI Dataset Object from a Set of Scans

- [`fmri_dataset_legacy()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_dataset_legacy.md)
  : Legacy fMRI Dataset Constructor

- [`fmri_group()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_group.md)
  : Create an fmri_group (one row per subject)

- [`fmri_h5_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_h5_dataset.md)
  : Create an fMRI Dataset Object from H5 Files

- [`fmri_latent_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_latent_dataset.md)
  **\[deprecated\]** : Create an fMRI Dataset Object from LatentNeuroVec
  Files or Objects

- [`fmri_mem_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_mem_dataset.md)
  : Create an fMRI Memory Dataset Object

- [`fmri_series()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_series.md)
  : fmri_series: fMRI Time Series Container

- [`fmri_series_resolvers`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_series_resolvers.md)
  : Helpers for fmri_series spatial and temporal selection

- [`fmri_study_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_study_dataset.md)
  : Create an fmri_study_dataset

- [`fmri_zarr_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/fmri_zarr_dataset.md)
  : Create an fMRI Dataset from Zarr Arrays

- [`generate_golden_test_data()`](https://bbuchsbaum.github.io/fmridataset/reference/generate_golden_test_data.md)
  : Generate Golden Test Data

- [`generics`](https://bbuchsbaum.github.io/fmridataset/reference/generics.md)
  : Generic Functions for fMRI Dataset Operations

- [`get_TR()`](https://bbuchsbaum.github.io/fmridataset/reference/get_TR.md)
  : Get TR (Repetition Time) from Sampling Frame

- [`get_backend_registry()`](https://bbuchsbaum.github.io/fmridataset/reference/get_backend_registry.md)
  : Get Registered Backend Information

- [`get_component_info()`](https://bbuchsbaum.github.io/fmridataset/reference/get_component_info.md)
  : Get Component Information

- [`get_data()`](https://bbuchsbaum.github.io/fmridataset/reference/get_data.md)
  : Get Data from fMRI Dataset Objects

- [`get_data_matrix()`](https://bbuchsbaum.github.io/fmridataset/reference/get_data_matrix.md)
  : Get Data Matrix from fMRI Dataset Objects

- [`get_latent_scores()`](https://bbuchsbaum.github.io/fmridataset/reference/get_latent_scores.md)
  : Get Latent Scores from Dataset

- [`get_mask()`](https://bbuchsbaum.github.io/fmridataset/reference/get_mask.md)
  : Get Mask from fMRI Dataset Objects

- [`get_run_duration()`](https://bbuchsbaum.github.io/fmridataset/reference/get_run_duration.md)
  : Get Run Duration from Sampling Frame

- [`get_run_lengths()`](https://bbuchsbaum.github.io/fmridataset/reference/get_run_lengths.md)
  : Get Run Lengths from Sampling Frame

- [`get_spatial_loadings()`](https://bbuchsbaum.github.io/fmridataset/reference/get_spatial_loadings.md)
  : Get Spatial Loadings from Dataset

- [`get_total_duration()`](https://bbuchsbaum.github.io/fmridataset/reference/get_total_duration.md)
  : Get Total Duration from Sampling Frame

- [`group_map()`](https://bbuchsbaum.github.io/fmridataset/reference/group_map.md)
  : Map a function over subjects in an fmri_group

- [`group_reduce()`](https://bbuchsbaum.github.io/fmridataset/reference/group_reduce.md)
  : Reduce over subjects in a single pass

- [`index_selector()`](https://bbuchsbaum.github.io/fmridataset/reference/index_selector.md)
  : Index-based Series Selector

- [`is.fmri_series()`](https://bbuchsbaum.github.io/fmridataset/reference/is.fmri_series.md)
  : Check if object is an fmri_series

- [`is.sampling_frame()`](https://bbuchsbaum.github.io/fmridataset/reference/is.sampling_frame.md)
  : Test if Object is a Sampling Frame

- [`is_backend_registered()`](https://bbuchsbaum.github.io/fmridataset/reference/is_backend_registered.md)
  : Check if Backend is Registered

- [`iter_subjects()`](https://bbuchsbaum.github.io/fmridataset/reference/iter_subjects.md)
  : Iterate subjects one-by-one (streaming)

- [`latent_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/latent_dataset.md)
  : Latent Dataset Interface

- [`left_join_subjects()`](https://bbuchsbaum.github.io/fmridataset/reference/left_join_subjects.md)
  : Left join additional subject metadata

- [`list_backend_names()`](https://bbuchsbaum.github.io/fmridataset/reference/list_backend_names.md)
  : List Registered Backend Names

- [`mask_selector()`](https://bbuchsbaum.github.io/fmridataset/reference/mask_selector.md)
  : Mask-based Series Selector

- [`matrix_dataset()`](https://bbuchsbaum.github.io/fmridataset/reference/matrix_dataset.md)
  : Matrix Dataset Constructor

- [`mutate_subjects()`](https://bbuchsbaum.github.io/fmridataset/reference/mutate_subjects.md)
  : Mutate subject-level attributes

- [`n_runs()`](https://bbuchsbaum.github.io/fmridataset/reference/n_runs.md)
  : Get Number of Runs from Sampling Frame

- [`n_subjects()`](https://bbuchsbaum.github.io/fmridataset/reference/n_subjects.md)
  : Number of subjects in a group

- [`n_timepoints()`](https://bbuchsbaum.github.io/fmridataset/reference/n_timepoints.md)
  : Get Number of Timepoints from Sampling Frame

- [`ncol(`*`<fmri_series>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/ncol.fmri_series.md)
  : Number of columns in fmri_series

- [`nrow(`*`<fmri_series>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/nrow.fmri_series.md)
  : Number of rows in fmri_series

- [`print(`*`<fmri_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/print.md)
  [`summary(`*`<fmri_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/print.md)
  [`print(`*`<chunkiter>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/print.md)
  [`print(`*`<data_chunk>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/print.md)
  [`print(`*`<matrix_dataset>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/print.md)
  : Print Methods for fmridataset Objects

- [`print(`*`<backend_registry>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/print.backend_registry.md)
  : Print Backend Registry

- [`print(`*`<fmri_series>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/print.fmri_series.md)
  : Print Method for fmri_series Objects

- [`print(`*`<series_selector>`*`)`](https://bbuchsbaum.github.io/fmridataset/reference/print.series_selector.md)
  : Print Methods for Series Selectors

- [`read_fmri_config()`](https://bbuchsbaum.github.io/fmridataset/reference/read_fmri_config.md)
  : read a basic fMRI configuration file

- [`reconstruct_voxels()`](https://bbuchsbaum.github.io/fmridataset/reference/reconstruct_voxels.md)
  : Reconstruct Voxel Data from Latent Representation

- [`register_backend()`](https://bbuchsbaum.github.io/fmridataset/reference/register_backend.md)
  : Register a Storage Backend

- [`resolve_indices()`](https://bbuchsbaum.github.io/fmridataset/reference/resolve_indices.md)
  : Resolve Indices from Series Selector

- [`roi_selector()`](https://bbuchsbaum.github.io/fmridataset/reference/roi_selector.md)
  : ROI-based Series Selector

- [`sample_subjects()`](https://bbuchsbaum.github.io/fmridataset/reference/sample_subjects.md)
  : Sample subjects from an fmri_group

- [`samples()`](https://bbuchsbaum.github.io/fmridataset/reference/samples.md)
  : Get Sample Indices from Sampling Frame

- [`series()`](https://bbuchsbaum.github.io/fmridataset/reference/series.md)
  :

  Deprecated alias for `fmri_series`

- [`series_selector`](https://bbuchsbaum.github.io/fmridataset/reference/series_selector.md)
  : Series Selector Classes for fMRI Data

- [`sphere_selector()`](https://bbuchsbaum.github.io/fmridataset/reference/sphere_selector.md)
  : Spherical ROI Series Selector

- [`stream_subjects()`](https://bbuchsbaum.github.io/fmridataset/reference/stream_subjects.md)
  : Stream subjects with optional ordering

- [`study_backend()`](https://bbuchsbaum.github.io/fmridataset/reference/study_backend.md)
  : Study Backend

- [`subject_ids()`](https://bbuchsbaum.github.io/fmridataset/reference/subject_ids.md)
  : Get Subject IDs from Multi-Subject Dataset

- [`subjects()`](https://bbuchsbaum.github.io/fmridataset/reference/subjects.md)
  [`` `subjects<-`() ``](https://bbuchsbaum.github.io/fmridataset/reference/subjects.md)
  : Access the subjects tibble stored inside an fmri_group

- [`unregister_backend()`](https://bbuchsbaum.github.io/fmridataset/reference/unregister_backend.md)
  : Unregister a Backend

- [`update_golden_test_data()`](https://bbuchsbaum.github.io/fmridataset/reference/update_golden_test_data.md)
  : Update Golden Test Data

- [`validate_fmri_group()`](https://bbuchsbaum.github.io/fmridataset/reference/validate_fmri_group.md)
  : Validate an fmri_group object

- [`validate_golden_test_data()`](https://bbuchsbaum.github.io/fmridataset/reference/validate_golden_test_data.md)
  : Validate Golden Test Data

- [`voxel_selector()`](https://bbuchsbaum.github.io/fmridataset/reference/voxel_selector.md)
  : Voxel Coordinate Series Selector

- [`with_rowData()`](https://bbuchsbaum.github.io/fmridataset/reference/with_rowData.md)
  : Attach rowData metadata to a lazy matrix

- [`write_fmri_config()`](https://bbuchsbaum.github.io/fmridataset/reference/write_fmri_config.md)
  : Write fMRI configuration file

# Articles

### All vignettes

- [Architecture Deep Dive: Design Principles and
  Extensibility](https://bbuchsbaum.github.io/fmridataset/articles/architecture-overview.md):
- [Backend Development Basics: Creating Custom Storage
  Backends](https://bbuchsbaum.github.io/fmridataset/articles/backend-development-basics.md):
- [Backend Registry: Extending Data Format
  Support](https://bbuchsbaum.github.io/fmridataset/articles/backend-registry.md):
- [Advanced Backend Development: Storage
  Extensions](https://bbuchsbaum.github.io/fmridataset/articles/extending-backends.md):
- [Getting Started with
  fmridataset](https://bbuchsbaum.github.io/fmridataset/articles/fmridataset-intro.md):
- [HDF5 Storage: High-Performance Data Management for Large-Scale fMRI
  Studies](https://bbuchsbaum.github.io/fmridataset/articles/h5-backend-usage.md):
- [Scaling to Study-Level Analysis: From Single Subjects to Group
  Studies](https://bbuchsbaum.github.io/fmridataset/articles/study-level-analysis.md):
