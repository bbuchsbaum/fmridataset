---
phase: 06-user-vignettes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - vignettes/architecture-overview.Rmd
autonomous: true

must_haves:
  truths:
    - "User can render architecture-overview.Rmd without errors"
    - "Code chunks with executable examples run successfully"
    - "Architectural concepts are demonstrated with working code"
  artifacts:
    - path: "vignettes/architecture-overview.Rmd"
      provides: "Architecture deep dive with executable examples"
      contains: "eval = TRUE"
  key_links:
    - from: "vignettes/architecture-overview.Rmd"
      to: "R/dataset_constructors.R"
      via: "matrix_dataset(), fmri_dataset() calls"
      pattern: "matrix_dataset|fmri_dataset"
    - from: "vignettes/architecture-overview.Rmd"
      to: "R/fmri_dataset.R"
      via: "backend access patterns"
      pattern: "backend_get_dims|backend"
---

<objective>
Fix architecture-overview.Rmd to have executable examples demonstrating design patterns.

Purpose: Enable users to understand fmridataset architecture through working code demonstrations.
Output: A vignette that renders without errors and demonstrates architectural concepts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-user-vignettes/06-CONTEXT.md
@vignettes/architecture-overview.Rmd
@R/dataset_constructors.R
@R/storage_backend.R
@R/all_generic.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable executable examples</name>
  <files>vignettes/architecture-overview.Rmd</files>
  <action>
    Current state: Global `eval = FALSE` at line 20. Most examples are non-executable.

    1. Change global knitr setup to `eval = TRUE`

    2. Review each code chunk and fix for execution:
       - `architecture-demo` (line 49): Should execute - creates matrix_dataset and study_dataset
       - `delegation-example` (line 141): Should execute - demonstrates delegation pattern
       - `factory-example` (line 165): Should execute - shows automatic backend selection
       - `observer-example` (line 185): Should execute - event table integration
       - `strategy-example` (line 219): Should execute - chunking strategies
       - `custom-dataset` (line 256): Should execute - ROI dataset example
       - `custom-backend` (line 338): Keep eval=FALSE (incomplete implementation)
       - `custom-temporal` (line 402): Should execute - variable TR example
       - `performance-architecture` (line 458): Should execute - benchmark simulation
       - `chunking-performance` (line 509): Should execute - chunking benchmark
       - `memory-architecture` (line 561): Should execute - memory patterns
       - `extensibility-architecture` (line 595): Should execute - interface demo
       - `architectural-decisions` (line 652): Should execute - framework functions
       - `interface-design` (line 680): Should execute - principles demo
       - `layer-debugging` (line 722): Should execute - debug strategies
       - `performance-debugging` (line 750): Should execute - diagnosis

    3. Add set.seed() calls where random data is generated

    4. Fix any undefined function references:
       - Check generate_example_fmri_data() usage matches vignette_helpers.R signature
       - Check backend_get_dims() signature

    5. Remove or fix simulated file references that won't work
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/architecture-overview.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>Vignette renders without errors, architectural patterns demonstrated with working code</done>
</task>

<task type="auto">
  <name>Task 2: Verify API accuracy and fix explanations</name>
  <files>vignettes/architecture-overview.Rmd</files>
  <action>
    1. Verify all backend-related calls:
       - dataset$backend access pattern
       - backend_get_dims() return structure (should have $time and $spatial)
       - Delegation to sampling_frame works

    2. Verify study dataset calls:
       - fmri_study_dataset() signature (datasets, subject_ids)
       - Study-level get_TR(), data_chunks() work

    3. Ensure explanations are clear:
       - Layer descriptions (Dataset, Backend, Temporal) are accurate
       - Design patterns (Delegation, Factory, Observer, Strategy) are demonstrated
       - Extension points are realistic

    4. Check "Integration with Other Vignettes" section:
       - Should reference fmridataset-intro.html as prerequisite
       - Should reference backend-registry.html, extending-backends.html
       - Should reference study-level-analysis.html, h5-backend-usage.html

    5. Fix any mock output blocks (lines starting with `# Expected output:`)
       to match actual output from executed code, or remove if redundant
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/architecture-overview.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>All API calls accurate, explanations clear, cross-references work</done>
</task>

</tasks>

<verification>
1. R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/architecture-overview.Rmd', quiet=TRUE)" exits 0
2. Key architectural patterns are demonstrated with working code
3. No warnings about undefined functions
</verification>

<success_criteria>
- architecture-overview.Rmd renders without errors
- Executable examples demonstrate architectural patterns
- API usage matches current package version
- Explanations are technically accurate and clear
</success_criteria>

<output>
After completion, create `.planning/phases/06-user-vignettes/06-02-SUMMARY.md`
</output>
