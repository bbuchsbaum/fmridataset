---
phase: 06-user-vignettes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vignettes/fmridataset-intro.Rmd
autonomous: true

must_haves:
  truths:
    - "User can render fmridataset-intro.Rmd without errors"
    - "All code chunks execute successfully"
    - "Examples use synthetic data with set.seed() for reproducibility"
  artifacts:
    - path: "vignettes/fmridataset-intro.Rmd"
      provides: "Getting started vignette with executable examples"
      contains: "eval = TRUE"
  key_links:
    - from: "vignettes/fmridataset-intro.Rmd"
      to: "R/dataset_constructors.R"
      via: "matrix_dataset(), fmri_file_dataset() calls"
      pattern: "matrix_dataset|fmri_file_dataset"
---

<objective>
Fix fmridataset-intro.Rmd to have fully executable examples.

Purpose: Enable users to learn fmridataset from a working, runnable introduction vignette.
Output: A vignette that renders without errors and demonstrates the core API.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-user-vignettes/06-CONTEXT.md
@vignettes/fmridataset-intro.Rmd
@R/dataset_constructors.R
@R/vignette_helpers.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix executable examples</name>
  <files>vignettes/fmridataset-intro.Rmd</files>
  <action>
    Review the vignette and ensure:

    1. Global knitr setup has `eval = TRUE` (already present at line 22)

    2. For chunks currently set to `eval = FALSE`:
       - `file-dataset` (line 169): Keep eval=FALSE (requires actual files)
       - `chunking` (line 253): Change to eval=TRUE with synthetic data
       - `runwise` (line 281): Change to eval=TRUE with synthetic data
       - `memory-management` (line 359): Keep eval=FALSE (file operations)

    3. Fix any chunks that reference undefined functions or variables

    4. Ensure all set.seed() calls are present for reproducibility

    5. Follow CONTEXT.md decisions:
       - Concept-first: explain idea, then show code
       - Synthetic data: no external files needed
       - Technical tone: precise, minimal narrative
       - Show data creation code

    6. If any helper functions from vignette_helpers.R are used (generate_example_fmri_data, etc.), ensure they are called correctly
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/fmridataset-intro.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>Vignette renders without errors, all eval=TRUE chunks execute</done>
</task>

<task type="auto">
  <name>Task 2: Verify API accuracy and add See Also section</name>
  <files>vignettes/fmridataset-intro.Rmd</files>
  <action>
    1. Verify all function calls match current API:
       - matrix_dataset() signature and parameters
       - get_TR(), n_runs(), n_timepoints() methods
       - get_data_matrix() with run_id parameter
       - data_chunks() with nchunks and runwise parameters
       - sampling_frame access via dataset$sampling_frame
       - samples() method on sampling frame

    2. Ensure explanations are clear and user-centric:
       - Check that concepts are explained before code
       - Gotchas/common mistakes are noted inline
       - Output shown only when it adds understanding

    3. Verify "See also" / "Next steps" section at end:
       - Should reference architecture-overview.Rmd
       - Should reference h5-backend-usage.Rmd
       - Should reference study-level-analysis.Rmd

    4. Fix any outdated API references or broken examples
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/fmridataset-intro.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>All API calls are accurate, explanations are clear, navigation to other vignettes works</done>
</task>

</tasks>

<verification>
1. R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/fmridataset-intro.Rmd', quiet=TRUE)" exits 0
2. Rendered HTML contains expected code output
3. No warnings about undefined functions
</verification>

<success_criteria>
- fmridataset-intro.Rmd renders without errors
- Executable examples demonstrate core workflow
- API usage matches current package version
- Explanations follow concept-first teaching approach
</success_criteria>

<output>
After completion, create `.planning/phases/06-user-vignettes/06-01-SUMMARY.md`
</output>
