---
phase: 07-developer-vignettes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - vignettes/extending-backends.Rmd
autonomous: true

must_haves:
  truths:
    - "Developer can render extending-backends.Rmd without errors"
    - "Core examples execute successfully with eval=TRUE"
    - "Advanced patterns are documented clearly (can remain eval=FALSE where appropriate)"
  artifacts:
    - path: "vignettes/extending-backends.Rmd"
      provides: "Advanced backend development vignette with executable core examples"
      contains: "eval = TRUE"
  key_links:
    - from: "vignettes/extending-backends.Rmd"
      to: "R/storage_backend.R"
      via: "backend contract methods"
      pattern: "backend_open|backend_close|backend_get_dims|backend_get_data|backend_get_mask"
---

<objective>
Fix extending-backends.Rmd to have executable core examples while keeping complex examples documented.

Purpose: Enable developers to learn advanced backend patterns from working examples.
Output: A vignette that renders without errors and demonstrates sophisticated techniques.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-developer-vignettes/07-CONTEXT.md
@.planning/phases/07-developer-vignettes/07-RESEARCH.md
@vignettes/extending-backends.Rmd
@R/storage_backend.R
@R/backend_registry.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable eval=TRUE and fix core examples</name>
  <files>vignettes/extending-backends.Rmd</files>
  <action>
    1. Change global knitr setup from `eval = FALSE` to `eval = TRUE` (line 20)

    2. Fix the advanced-backend chunk (lines 40-389):
       - neurostream_backend example - the core demonstration
       - Uses URL validation with grepl - make it accept test URLs
       - Uses cache directory creation - use tempdir() instead of fixed path
       - register_backend() with unique name "neurostream" or "demo_neurostream"
       - This is the KEY example - must execute
       - Uses simulated data with set.seed(42) - good for reproducibility

    3. Fix the advanced-usage chunk (lines 393-439):
       - Currently expects running neurostream backend
       - Depends on advanced-backend chunk executing
       - May need to skip fmri_dataset() call if it validates dimensions strictly

    4. For conceptual/demonstration chunks, evaluate each:

       LIKELY KEEP eval=FALSE (complex, optional dependencies):
       - protocol-abstraction (503-565): Complex protocol negotiation demo
       - memory-management (571-687): Uses optional packages (pryr, mmap)
       - quality-assurance (695-886): Uses digest package
       - cloud-integration (899-1012): Cloud config simulation
       - realtime-streaming (1018-1148): Complex real-time system

       LIKELY MAKE eval=TRUE (self-contained):
       - development-workflow (lines around 908): Backend checklist function
       - error-handling-strategies (around 951): Demonstration functions
       - testing-strategies (around 1013): Test suite creation
       - network-troubleshooting (around 1538): Diagnostic functions
       - cache-troubleshooting (around 1641): Cache analysis

    5. For each chunk that stays eval=FALSE, add comment explaining why:
       "# This example requires optional packages: {pkg1}, {pkg2}"
       OR
       "# This demonstrates concepts - not meant to execute"

    6. Ensure %||% operator is defined early (before any chunk uses it)

    7. Use requireNamespace() checks for optional packages:
       - digest, microbenchmark, profvis, profmem, pryr, parallel
       - Show pattern: if (requireNamespace("pkg", quietly=TRUE)) { ... }
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/extending-backends.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>Vignette renders without errors, core neurostream example executes</done>
</task>

<task type="auto">
  <name>Task 2: Verify API accuracy and clean up patterns</name>
  <files>vignettes/extending-backends.Rmd</files>
  <action>
    1. Verify all backend methods match R/storage_backend.R:
       - backend_open(backend) returns modified backend
       - backend_close(backend) returns invisible(NULL) or invisible(backend)
       - backend_get_dims returns list(spatial=c(x,y,z), time=n)
       - backend_get_data(backend, rows=NULL, cols=NULL) returns matrix
       - backend_get_mask returns logical vector
       - backend_get_metadata returns list

    2. Check registry API usage:
       - register_backend() parameters match R/backend_registry.R
       - create_backend() usage is correct

    3. Fix any outdated patterns from research:
       - Research says extending-backends adds optional methods on top of basics
       - Verify chunking/iteration patterns match actual implementation

    4. Check the production deployment section (lines 1191-1351):
       - Contains monitoring, config management, security examples
       - These are demonstrations - eval=FALSE is fine

    5. Check testing framework section (lines 1357-1518):
       - Contains comprehensive testing patterns
       - Can be eval=FALSE as demonstration

    6. Verify See Also links (lines 1731-1746):
       - Foundation: backend-registry.html
       - Architecture: architecture-overview.html
       - Practical: fmridataset-intro.html, study-level-analysis.html, h5-backend-usage.html

    7. Clean up any redundant or overly complex examples that don't add value
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/extending-backends.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>All API calls match current implementation, patterns are clear</done>
</task>

</tasks>

<verification>
1. R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/extending-backends.Rmd', quiet=TRUE)" exits 0
2. Core neurostream backend example creates working backend
3. No errors from executed chunks
4. Non-executable chunks clearly marked as demonstrations
</verification>

<success_criteria>
- extending-backends.Rmd renders without errors
- Core streaming backend example executes
- Advanced patterns are documented (eval=FALSE where appropriate)
- API usage matches current package version
- Clear distinction between executable examples and conceptual demonstrations
</success_criteria>

<output>
After completion, create `.planning/phases/07-developer-vignettes/07-03-SUMMARY.md`
</output>
