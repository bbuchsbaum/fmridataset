---
phase: 07-developer-vignettes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - vignettes/backend-registry.Rmd
autonomous: true

must_haves:
  truths:
    - "Developer can render backend-registry.Rmd without errors"
    - "All code chunks execute successfully with eval=TRUE"
    - "Examples demonstrate register_backend(), create_backend(), and registry introspection"
  artifacts:
    - path: "vignettes/backend-registry.Rmd"
      provides: "Backend registry vignette with executable examples"
      contains: "eval = TRUE"
  key_links:
    - from: "vignettes/backend-registry.Rmd"
      to: "R/backend_registry.R"
      via: "register_backend, create_backend, is_backend_registered calls"
      pattern: "register_backend|create_backend|is_backend_registered|get_backend_registry"
---

<objective>
Fix backend-registry.Rmd to have fully executable examples.

Purpose: Enable developers to learn backend registration and the pluggable architecture.
Output: A vignette that renders without errors and demonstrates the registry system.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-developer-vignettes/07-CONTEXT.md
@.planning/phases/07-developer-vignettes/07-RESEARCH.md
@vignettes/backend-registry.Rmd
@R/backend_registry.R
@R/storage_backend.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable eval=TRUE and fix executable examples</name>
  <files>vignettes/backend-registry.Rmd</files>
  <action>
    1. Change global knitr setup from `eval = FALSE` to `eval = TRUE` (line 20)

    2. Fix the backend-example chunk (lines 40-136):
       - Creates csv_backend - needs to work with synthetic data
       - The example uses file.exists() check - create a temp file or skip the check
       - register_backend() call must work - check no name collision with built-in backends
       - Use unique backend name like "demo_csv" to avoid collision

    3. Fix the backend-usage chunk (lines 140-172):
       - Currently references example_data.csv which doesn't exist
       - Either create a temp file, or restructure to use in-memory data
       - create_backend() call must succeed

    4. Fix robust-backend chunk (lines 226-429):
       - advanced_csv_backend example uses file validation
       - Either mock file existence or use in-memory approach
       - Ensure register_backend() uses unique name

    5. Fix backend-testing chunk (lines 437-553):
       - test_backend_contract() function references create_backend()
       - Ensure test works with the backends defined in the vignette

    6. For chunks that should remain eval=FALSE:
       - performance-optimization (lines 560-628): Keep eval=FALSE if it requires external packages
       - Any benchmark-heavy examples can stay eval=FALSE

    7. Fix package-integration chunk (lines 640-675):
       - Pure documentation output, can be eval=TRUE

    8. Fix custom-validation chunk (lines 683-796):
       - Uses digest package - add requireNamespace check or keep eval=FALSE

    9. Fix backend-composition chunk (lines 804-876):
       - Composite backend example - make executable or keep eval=FALSE

    10. For all executable chunks, ensure:
        - set.seed() for reproducibility
        - %||% operator defined if needed
        - All required packages loaded or checked with requireNamespace()
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/backend-registry.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>Vignette renders without errors, key examples execute</done>
</task>

<task type="auto">
  <name>Task 2: Verify API accuracy and integration links</name>
  <files>vignettes/backend-registry.Rmd</files>
  <action>
    1. Verify registry API calls match R/backend_registry.R:
       - register_backend(name, factory, description, validate_function, overwrite)
       - get_backend_registry(name=NULL) - returns list of registrations or specific one
       - is_backend_registered(name) - returns logical
       - create_backend(name, ..., validate) - creates and optionally validates
       - list_backend_names() - returns character vector
       - unregister_backend(name) - removes from registry

    2. Verify backend_close() return value:
       - In examples, some return invisible(NULL), some return invisible(backend)
       - R/storage_backend.R says "Return NULL (invisibly)"
       - Update examples to use consistent invisible(NULL) or invisible(backend)

    3. Check troubleshooting section (lines 1057-1136):
       - diagnose_backend_issues() function should work if made executable
       - Or keep as demonstration code with eval=FALSE

    4. Check See Also section (lines 1192-1207):
       - Prerequisites: architecture-overview.html
       - Practical: fmridataset-intro.html
       - Advanced: extending-backends.html, h5-backend-usage.html, study-level-analysis.html

    5. Clean up any outdated patterns:
       - Research mentions backend_registry$has_backend() which doesn't exist
       - Should be is_backend_registered() instead
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/backend-registry.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>All API calls match current implementation, no outdated patterns</done>
</task>

</tasks>

<verification>
1. R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/backend-registry.Rmd', quiet=TRUE)" exits 0
2. register_backend() and create_backend() calls work with demo backends
3. No warnings about undefined functions
</verification>

<success_criteria>
- backend-registry.Rmd renders without errors
- Registration and creation examples work
- API usage matches current package version
- Examples use unique backend names to avoid collisions
- Clear explanation of pluggable architecture
</success_criteria>

<output>
After completion, create `.planning/phases/07-developer-vignettes/07-02-SUMMARY.md`
</output>
