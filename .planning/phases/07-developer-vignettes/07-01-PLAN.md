---
phase: 07-developer-vignettes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vignettes/backend-development-basics.Rmd
autonomous: true

must_haves:
  truths:
    - "Developer can render backend-development-basics.Rmd without errors"
    - "All code chunks execute successfully with eval=TRUE"
    - "Examples create working backends that pass validate_backend()"
  artifacts:
    - path: "vignettes/backend-development-basics.Rmd"
      provides: "Backend development basics vignette with executable examples"
      contains: "eval = TRUE"
  key_links:
    - from: "vignettes/backend-development-basics.Rmd"
      to: "R/storage_backend.R"
      via: "backend_open, backend_close, backend_get_dims, backend_get_data, backend_get_mask calls"
      pattern: "backend_open|backend_close|backend_get_dims|backend_get_data|backend_get_mask"
---

<objective>
Fix backend-development-basics.Rmd to have fully executable examples.

Purpose: Enable developers to learn backend creation from a working, runnable basics vignette.
Output: A vignette that renders without errors and demonstrates the backend contract.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-developer-vignettes/07-CONTEXT.md
@.planning/phases/07-developer-vignettes/07-RESEARCH.md
@vignettes/backend-development-basics.Rmd
@R/storage_backend.R
@R/matrix_backend.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix executable examples</name>
  <files>vignettes/backend-development-basics.Rmd</files>
  <action>
    Review the vignette and ensure all code chunks execute:

    1. Confirm global knitr setup has `eval = TRUE` (line 20)

    2. Check helper file sourcing (lines 29-32):
       - vignette_helpers.R exists in R/, sourcing should work
       - If path causes issues during build, remove or fix the conditional

    3. Verify all backend examples execute:
       - json_backend example (lines 138-246): Uses synthetic data, should execute
       - optional-methods chunk (lines 277-324): Currently eval=FALSE, keep as-is OR make executable with proper setup
       - stateful_backend (lines 334-417): Should execute
       - lazy_backend (lines 421-508): Should execute
       - validation-pattern (lines 514-548): Should execute
       - cached_backend (lines 556-673): Needs `%||%` defined before use
       - robust_backend (lines 679-793): Should execute
       - test_backend (lines 867-921): Should execute

    4. Fix any undefined symbols:
       - Ensure `%||%` is defined before cached_backend chunk (line 658 defines it, but may be needed earlier)
       - Check all required packages are loaded

    5. Follow CONTEXT.md decisions:
       - Build incrementally - simplest backend first, add features
       - Minimal viable implementations - only required methods
       - Use synthetic/in-memory data - no external dependencies
       - Focus on happy path - mention error handling exists but don't clutter

    6. Ensure set.seed() calls are present for reproducibility in any randomized examples
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/backend-development-basics.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>Vignette renders without errors, all eval=TRUE chunks execute</done>
</task>

<task type="auto">
  <name>Task 2: Verify API accuracy and See Also links</name>
  <files>vignettes/backend-development-basics.Rmd</files>
  <action>
    1. Verify all backend methods match current API in R/storage_backend.R:
       - backend_open(backend) -> returns modified backend
       - backend_close(backend) -> returns invisible(backend) or invisible(NULL)
       - backend_get_dims(backend) -> returns list(spatial=c(x,y,z), time=n)
       - backend_get_data(backend, rows=NULL, cols=NULL) -> returns matrix
       - backend_get_mask(backend) -> returns logical vector
       - backend_get_metadata(backend) -> returns list (optional but shown)

    2. Verify dimension format matches spec:
       - spatial must be 3-element numeric vector
       - time must be positive integer
       - mask length must equal prod(spatial)

    3. Ensure the "Integration with Other Vignettes" section (lines 945-959) has accurate links:
       - Prerequisites: fmridataset-intro.html, architecture-overview.html
       - Next Steps: backend-registry.html, extending-backends.html
       - Applications: h5-backend-usage.html

    4. Ensure explanations follow incremental teaching:
       - Concept before code
       - Each example builds on previous
       - Clear progression from minimal to advanced
  </action>
  <verify>
    R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/backend-development-basics.Rmd', output_format='html_document', quiet=TRUE); cat('SUCCESS\n')"
  </verify>
  <done>All API calls match current implementation, links are valid</done>
</task>

</tasks>

<verification>
1. R -q -e "suppressPackageStartupMessages(devtools::load_all()); rmarkdown::render('vignettes/backend-development-basics.Rmd', quiet=TRUE)" exits 0
2. Rendered HTML contains expected code output from all eval=TRUE chunks
3. No warnings about undefined functions or methods
</verification>

<success_criteria>
- backend-development-basics.Rmd renders without errors
- All backend examples create working backends
- validate_backend_contract() function works on examples
- API usage matches current package version
- Clear incremental teaching progression
</success_criteria>

<output>
After completion, create `.planning/phases/07-developer-vignettes/07-01-SUMMARY.md`
</output>
