---
phase: 01-cran-quick-wins
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - R/golden_data_generation.R
  - R/all_generic.R
autonomous: true

must_haves:
  truths:
    - "R CMD check produces no NOTE about undefined global function generate_all_golden_data"
    - "R CMD check produces no NOTE about Rd cross-reference missing package anchor"
  artifacts:
    - path: "R/golden_data_generation.R"
      provides: "Golden data functions without undefined global references"
      min_lines: 50
    - path: "R/all_generic.R"
      provides: "Properly anchored cross-package documentation links"
      contains: "fmrihrf::sampling_frame"
  key_links:
    - from: "R/all_generic.R"
      to: "fmrihrf package"
      via: "roxygen2 cross-reference"
      pattern: "fmrihrf::sampling_frame"
---

<objective>
Fix code issues: remove exported function's dependency on test helper and fix cross-package documentation link

Purpose: CRAN-02 requires fixing the architectural issue where generate_golden_test_data() calls generate_all_golden_data() which only exists in tests/. CRAN-03 requires adding package anchor to sampling_frame cross-reference.

Output: Clean R code without undefined globals and properly anchored Rd cross-references.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-cran-quick-wins/01-RESEARCH.md

@R/golden_data_generation.R
@R/all_generic.R
@tests/testthat/helper-golden.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove export of golden data generation functions</name>
  <files>R/golden_data_generation.R</files>
  <action>
The research recommends OPTION B: Remove the exports entirely since golden data generation is development-time tooling, not user-facing API.

Modify R/golden_data_generation.R:
1. Remove @export tags from all three functions:
   - generate_golden_test_data
   - update_golden_test_data
   - validate_golden_test_data

2. Add @noRd tag to each function (suppresses Rd file generation)

3. Add @keywords internal tag to each function

The functions will remain in the package for internal use but won't be exported to users. The call to generate_all_golden_data() from source() is acceptable for internal functions since it's only called during development, not at runtime.

Alternatively, if the functions should be completely removed from the package, delete R/golden_data_generation.R entirely and keep the functionality only in tests/testthat/helper-golden.R. This is the cleaner approach if these functions are truly only for test development.

RECOMMENDATION: Delete the file entirely. These are development utilities that belong in tests/ or inst/scripts/, not in R/. The @export was an architectural mistake.
  </action>
  <verify>
After deletion:
- ls R/golden_data_generation.R should fail (file doesn't exist)
- grep -r "generate_golden_test_data" R/*.R should return nothing

OR after removing exports:
- grep "@export" R/golden_data_generation.R should return nothing
- grep "@noRd" R/golden_data_generation.R should show 3 matches
  </verify>
  <done>R/golden_data_generation.R is deleted OR all @export tags removed and replaced with @noRd @keywords internal</done>
</task>

<task type="auto">
  <name>Task 2: Fix sampling_frame cross-reference in get_TR documentation</name>
  <files>R/all_generic.R</files>
  <action>
In R/all_generic.R, find the get_TR documentation (around line 273) which contains:
```r
#' \code{\link{sampling_frame}} for creating temporal structures,
```

Replace with properly anchored cross-package reference:
```r
#' [fmrihrf::sampling_frame()] for creating temporal structures,
```

This uses roxygen2's markdown link syntax which generates proper package-anchored Rd links.

After editing, run: R -e "devtools::document()" to regenerate man/get_TR.Rd with the correct link.
  </action>
  <verify>
1. grep "fmrihrf::sampling_frame" R/all_generic.R should show the updated reference
2. After running devtools::document(), grep "sampling_frame" man/get_TR.Rd should show proper package anchor
  </verify>
  <done>R/all_generic.R uses [fmrihrf::sampling_frame()] syntax and man/get_TR.Rd has proper package anchor</done>
</task>

</tasks>

<verification>
After both tasks, run devtools::document() then devtools::check():
```bash
R -e "devtools::document(); devtools::check()" 2>&1 | grep -E "generate_all_golden_data|sampling_frame|missing package anchors"
```

Expected: No matches (issues resolved).
</verification>

<success_criteria>
- R CMD check no longer produces NOTE about undefined global function generate_all_golden_data
- R CMD check no longer produces NOTE about Rd cross-reference missing package anchor for sampling_frame
- Package still builds and passes existing tests
</success_criteria>

<output>
After completion, create `.planning/phases/01-cran-quick-wins/01-02-SUMMARY.md`
</output>
