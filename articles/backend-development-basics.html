<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Backend Development Basics: Creating Custom Storage Backends • fmridataset</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Backend Development Basics: Creating Custom Storage Backends">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmridataset</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/architecture-overview.html">Architecture Deep Dive: Design Principles and Extensibility</a></li>
    <li><a class="dropdown-item" href="../articles/backend-development-basics.html">Backend Development Basics: Creating Custom Storage Backends</a></li>
    <li><a class="dropdown-item" href="../articles/backend-registry.html">Backend Registry: Extending Data Format Support</a></li>
    <li><a class="dropdown-item" href="../articles/extending-backends.html">Advanced Backend Development: Storage Extensions</a></li>
    <li><a class="dropdown-item" href="../articles/fmridataset-intro.html">Getting Started with fmridataset</a></li>
    <li><a class="dropdown-item" href="../articles/h5-backend-usage.html">HDF5 Storage: High-Performance Data Management for Large-Scale fMRI Studies</a></li>
    <li><a class="dropdown-item" href="../articles/study-level-analysis.html">Scaling to Study-Level Analysis: From Single Subjects to Group Studies</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmridataset/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Backend Development Basics: Creating Custom Storage Backends</h1>
                        <h4 data-toc-skip class="author">fmridataset
Team</h4>
            
            <h4 data-toc-skip class="date">2026-01-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmridataset/blob/main/vignettes/backend-development-basics.Rmd" class="external-link"><code>vignettes/backend-development-basics.Rmd</code></a></small>
      <div class="d-none name"><code>backend-development-basics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation-why-create-custom-backends">Motivation: Why Create Custom Backends?<a class="anchor" aria-label="anchor" href="#motivation-why-create-custom-backends"></a>
</h2>
<p>Your research group has been using a custom MATLAB pipeline that
exports preprocessed fMRI data as JSON files with separate metadata. The
data format is optimized for your specific analyses, includes custom
quality metrics, and integrates with your lab’s database system. Rather
than converting all this data to standard formats or writing custom
loading code for each analysis, you can create a backend that makes this
format work seamlessly with fmridataset.</p>
<p>Creating a custom backend means your specialized data format
immediately gains access to all fmridataset features: unified
interfaces, efficient chunking, study-level operations, and
compatibility with the entire ecosystem. This vignette teaches you the
essentials of backend development through practical examples, showing
you how to implement the required interface and optimize for your
specific use case.</p>
</div>
<div class="section level2">
<h2 id="backend-contract-specifications">Backend Contract Specifications<a class="anchor" aria-label="anchor" href="#backend-contract-specifications"></a>
</h2>
<div class="section level3">
<h3 id="required-methods">Required Methods<a class="anchor" aria-label="anchor" href="#required-methods"></a>
</h3>
<p>All storage backends must implement these six core methods:</p>
<div class="section level4">
<h4 id="backend_openbackend">
<code>backend_open(backend)</code><a class="anchor" aria-label="anchor" href="#backend_openbackend"></a>
</h4>
<p><strong>Purpose</strong>: Initialize backend and acquire necessary
resources. <strong>Requirements</strong>: - Must be idempotent (safe to
call multiple times) - Must set internal state to track open status -
Must validate data source accessibility - Must return the modified
backend object</p>
<p><strong>Implementation Requirements</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">backend_open.my_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>  <span class="co"># Acquire resources, validate data source</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="backend_closebackend">
<code>backend_close(backend)</code><a class="anchor" aria-label="anchor" href="#backend_closebackend"></a>
</h4>
<p><strong>Purpose</strong>: Release all resources and clean up state.
<strong>Requirements</strong>: - Must be idempotent (safe to call on
closed backends) - Must release all held resources (files, connections,
memory) - Must set internal state to indicate closed status - Must
return invisibly</p>
<p><strong>Implementation Requirements</strong>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">backend_close.my_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Release resources</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="backend_get_dimsbackend">
<code>backend_get_dims(backend)</code><a class="anchor" aria-label="anchor" href="#backend_get_dimsbackend"></a>
</h4>
<p><strong>Purpose</strong>: Return data dimensions in canonical format.
<strong>Requirements</strong>: - Must return a list with
<code>spatial</code> and <code>time</code> elements -
<code>spatial</code> must be integer vector
<code>c(n_voxels, n_spatial_dim2, n_spatial_dim3)</code> -
<code>time</code> must be integer scalar indicating number of timepoints
- Must work only on open backends</p>
<p><strong>Implementation Requirements</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">backend_get_dims.my_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend must be opened first"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_voxels</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, time <span class="op">=</span> <span class="va">n_timepoints</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="backend_get_databackend-rows-null-cols-null">
<code>backend_get_data(backend, rows = NULL, cols = NULL)</code><a class="anchor" aria-label="anchor" href="#backend_get_databackend-rows-null-cols-null"></a>
</h4>
<p><strong>Purpose</strong>: Extract data matrix with optional
subsetting. <strong>Requirements</strong>: - Must return matrix with
dimensions (timepoints × voxels) - <code>rows</code> parameter: integer
vector specifying timepoint indices (1-based) - <code>cols</code>
parameter: integer vector specifying voxel indices (1-based) - Must
handle <code>NULL</code> parameters (return all data) - Must preserve
matrix format for single row/column selections</p>
</div>
<div class="section level4">
<h4 id="backend_get_maskbackend">
<code>backend_get_mask(backend)</code><a class="anchor" aria-label="anchor" href="#backend_get_maskbackend"></a>
</h4>
<p><strong>Purpose</strong>: Return logical mask indicating valid
voxels. <strong>Requirements</strong>: - Must return logical vector of
length equal to number of spatial elements - <code>TRUE</code> indicates
valid voxel, <code>FALSE</code> indicates invalid/missing voxel - Must
be consistent with data returned by <code><a href="../reference/backend_get_data.html">backend_get_data()</a></code></p>
</div>
<div class="section level4">
<h4 id="backend_validatebackend-optional">
<code>backend_validate(backend)</code> (Optional)<a class="anchor" aria-label="anchor" href="#backend_validatebackend-optional"></a>
</h4>
<p><strong>Purpose</strong>: Validate backend state and data integrity.
<strong>Requirements</strong>: - Return logical scalar:
<code>TRUE</code> if valid, <code>FALSE</code> if invalid - Should check
internal consistency, data availability, and format compliance</p>
</div>
</div>
<div class="section level3">
<h3 id="performance-requirements">Performance Requirements<a class="anchor" aria-label="anchor" href="#performance-requirements"></a>
</h3>
<ul>
<li>
<strong>Lazy Loading</strong>: Avoid loading large datasets in
constructor or <code><a href="../reference/backend_open.html">backend_open()</a></code>
</li>
<li>
<strong>Memory Efficiency</strong>: Load only requested data subsets
in <code><a href="../reference/backend_get_data.html">backend_get_data()</a></code>
</li>
<li>
<strong>Idempotency</strong>: <code><a href="../reference/backend_open.html">backend_open()</a></code> and
<code><a href="../reference/backend_close.html">backend_close()</a></code> must be safely repeatable</li>
<li>
<strong>Error Handling</strong>: Provide informative error messages
for common failure modes</li>
</ul>
</div>
<div class="section level3">
<h3 id="state-management-requirements">State Management Requirements<a class="anchor" aria-label="anchor" href="#state-management-requirements"></a>
</h3>
<ul>
<li>
<strong>Open State Tracking</strong>: Maintain internal
<code>is_open</code> flag</li>
<li>
<strong>Resource Management</strong>: Clean resource acquisition and
release patterns</li>
<li>
<strong>Thread Safety</strong>: Consider concurrent access if
backend will be used in parallel contexts</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="quick-start-json-backend-example">Quick Start: JSON Backend Example<a class="anchor" aria-label="anchor" href="#quick-start-json-backend-example"></a>
</h2>
<p>Let’s create a working backend for JSON-formatted fMRI data that
demonstrates all the essential concepts:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a complete JSON backend implementation</span></span>
<span><span class="va">json_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">json_file</span>, <span class="va">metadata_file</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Input validation</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">json_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"JSON file not found: "</span>, <span class="va">json_file</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Initialize backend structure</span></span>
<span>  <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    json_file <span class="op">=</span> <span class="va">json_file</span>,</span>
<span>    metadata_file <span class="op">=</span> <span class="va">metadata_file</span>,</span>
<span>    data_cache <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    dims_cache <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    is_open <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"json_backend"</span>, <span class="st">"storage_backend"</span><span class="op">)</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implement the open method</span></span>
<span><span class="va">backend_open.json_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="co"># Already open</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Simulate reading JSON data (in practice, use jsonlite::fromJSON)</span></span>
<span>  <span class="co"># For demonstration, create synthetic data</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>  <span class="va">n_time</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>  <span class="va">n_voxels</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">data_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_time</span> <span class="op">*</span> <span class="va">n_voxels</span><span class="op">)</span>,</span>
<span>    nrow <span class="op">=</span> <span class="va">n_time</span>,</span>
<span>    ncol <span class="op">=</span> <span class="va">n_voxels</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_voxels</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># Flat spatial structure</span></span>
<span>    time <span class="op">=</span> <span class="va">n_time</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implement the close method</span></span>
<span><span class="va">backend_close.json_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">data_cache</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implement dimension query</span></span>
<span><span class="va">backend_get_dims.json_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend must be opened first"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implement data access</span></span>
<span><span class="va">backend_get_data.json_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span>, <span class="va">rows</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">cols</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend must be opened first"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">backend</span><span class="op">$</span><span class="va">data_cache</span></span>
<span></span>
<span>  <span class="co"># Handle subsetting</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">rows</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="va">cols</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implement mask generation</span></span>
<span><span class="va">backend_get_mask.json_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend must be opened first"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># All voxels are valid in our JSON format</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span><span class="op">$</span><span class="va">spatial</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the backend</span></span>
<span><span class="va">json_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="st">"{}"</span>, <span class="va">json_file</span><span class="op">)</span> <span class="co"># Create dummy file</span></span>
<span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">json_backend</span><span class="op">(</span><span class="va">json_file</span><span class="op">)</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_open.html">backend_open</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_dims.html">backend_get_dims</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Backend dimensions - Time:"</span>, <span class="va">dims</span><span class="op">$</span><span class="va">time</span>, <span class="st">"Spatial:"</span>, <span class="va">dims</span><span class="op">$</span><span class="va">spatial</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Backend dimensions - Time: 100 Spatial: 500</span></span>
<span></span>
<span><span class="co"># Get some data</span></span>
<span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_data.html">backend_get_data</a></span><span class="op">(</span><span class="va">backend</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Retrieved data shape:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Retrieved data shape: 10 50</span></span>
<span></span>
<span><span class="fu"><a href="../reference/backend_close.html">backend_close</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span></code></pre></div>
<p><strong>Interface Specification</strong>: Backends require
implementation of six core methods to integrate with the fmridataset
ecosystem. This minimal interface enables full compatibility with all
package features.</p>
</div>
<div class="section level2">
<h2 id="understanding-the-backend-contract">Understanding the Backend Contract<a class="anchor" aria-label="anchor" href="#understanding-the-backend-contract"></a>
</h2>
<p>The backend contract defines the minimal interface that all backends
must implement. Understanding this contract is essential for creating
compatible backends.</p>
<div class="section level3">
<h3 id="required-methods-1">Required Methods<a class="anchor" aria-label="anchor" href="#required-methods-1"></a>
</h3>
<p>Every backend must implement these five S3 methods:</p>
<div class="section level4">
<h4 id="backend_open">1. backend_open()<a class="anchor" aria-label="anchor" href="#backend_open"></a>
</h4>
<p>Opens the backend and acquires resources (file handles, connections,
memory). This method should be idempotent - calling it multiple times on
an open backend should be safe.</p>
</div>
<div class="section level4">
<h4 id="backend_close">2. backend_close()<a class="anchor" aria-label="anchor" href="#backend_close"></a>
</h4>
<p>Releases all resources and cleans up. After closing, the backend
should not hold any external resources.</p>
</div>
<div class="section level4">
<h4 id="backend_get_dims">3. backend_get_dims()<a class="anchor" aria-label="anchor" href="#backend_get_dims"></a>
</h4>
<p>Returns dimensions as a list with <code>spatial</code> (3-element
vector) and <code>time</code> (single integer) elements. This must work
without loading all data.</p>
</div>
<div class="section level4">
<h4 id="backend_get_data">4. backend_get_data()<a class="anchor" aria-label="anchor" href="#backend_get_data"></a>
</h4>
<p>Returns data in timepoints × voxels orientation. Must support
optional row and column subsetting for efficient partial loading.</p>
</div>
<div class="section level4">
<h4 id="backend_get_mask">5. backend_get_mask()<a class="anchor" aria-label="anchor" href="#backend_get_mask"></a>
</h4>
<p>Returns a logical vector indicating valid voxels. Length must equal
the product of spatial dimensions.</p>
</div>
</div>
<div class="section level3">
<h3 id="optional-methods">Optional Methods<a class="anchor" aria-label="anchor" href="#optional-methods"></a>
</h3>
<p>These methods enhance functionality but aren’t required:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Optional: Metadata extraction</span></span>
<span><span class="va">backend_get_metadata.json_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend must be opened first"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    format <span class="op">=</span> <span class="st">"json"</span>,</span>
<span>    compression <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    creation_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    custom_metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      quality_score <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>      motion_level <span class="op">=</span> <span class="st">"low"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Optional: Validation</span></span>
<span><span class="va">backend_validate.json_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check data integrity</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Validate dimensions</span></span>
<span>  <span class="va">dims</span> <span class="op">&lt;-</span> <span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span></span>
<span>  <span class="va">expected_size</span> <span class="op">&lt;-</span> <span class="va">dims</span><span class="op">$</span><span class="va">time</span> <span class="op">*</span> <span class="va">dims</span><span class="op">$</span><span class="va">spatial</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">actual_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">data_cache</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">expected_size</span> <span class="op">!=</span> <span class="va">actual_size</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Data size mismatch"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="cn">TRUE</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test optional methods</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_open.html">backend_open</a></span><span class="op">(</span><span class="fu">json_backend</span><span class="op">(</span><span class="va">json_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_metadata.html">backend_get_metadata</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Format:"</span>, <span class="va">metadata</span><span class="op">$</span><span class="va">format</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Quality score:"</span>, <span class="va">metadata</span><span class="op">$</span><span class="va">custom_metrics</span><span class="op">$</span><span class="va">quality_score</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">is_valid</span> <span class="op">&lt;-</span> <span class="fu">backend_validate</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Backend valid:"</span>, <span class="va">is_valid</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/backend_close.html">backend_close</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="deep-dive-implementation-patterns">Deep Dive: Implementation Patterns<a class="anchor" aria-label="anchor" href="#deep-dive-implementation-patterns"></a>
</h2>
<p>Let’s explore common patterns that make backends robust and
efficient.</p>
<div class="section level3">
<h3 id="state-management-pattern">State Management Pattern<a class="anchor" aria-label="anchor" href="#state-management-pattern"></a>
</h3>
<p>Backends need to track whether they’re open and manage resources
appropriately:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Robust state management example</span></span>
<span><span class="va">stateful_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">source</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="va">source</span>,</span>
<span>    <span class="co"># State flags</span></span>
<span>    is_open <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    is_validated <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    has_error <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co"># Resource tracking</span></span>
<span>    resources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="co"># Error information</span></span>
<span>    last_error <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stateful_backend"</span>, <span class="st">"storage_backend"</span><span class="op">)</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Safe resource acquisition</span></span>
<span><span class="va">backend_open.stateful_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="co"># Idempotent</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="co"># Acquire resources</span></span>
<span>      <span class="va">backend</span><span class="op">$</span><span class="va">resources</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>      <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>      <span class="va">backend</span><span class="op">$</span><span class="va">has_error</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">backend</span><span class="op">$</span><span class="va">has_error</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>      <span class="va">backend</span><span class="op">$</span><span class="va">last_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Failed to open backend: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Safe resource cleanup</span></span>
<span><span class="va">backend_close.stateful_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span><span class="op">)</span> <span class="co"># Already closed</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Release all resources</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">resources</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implement other required methods...</span></span>
<span><span class="va">backend_get_dims.stateful_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, time <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_data.stateful_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span>, <span class="va">rows</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">cols</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">backend</span><span class="op">$</span><span class="va">resources</span><span class="op">$</span><span class="va">data</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span><span class="op">)</span> <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">rows</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span> <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="va">cols</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_mask.stateful_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test state management</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">stateful_backend</span><span class="op">(</span><span class="st">"dummy_source"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Initial state - is_open:"</span>, <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initial state - is_open: FALSE</span></span>
<span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_open.html">backend_open</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"After open - is_open:"</span>, <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; After open - is_open: TRUE</span></span>
<span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_close.html">backend_close</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"After close - is_open:"</span>, <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; After close - is_open: FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lazy-loading-pattern">Lazy Loading Pattern<a class="anchor" aria-label="anchor" href="#lazy-loading-pattern"></a>
</h3>
<p>Implement lazy loading to defer expensive operations:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Lazy loading backend</span></span>
<span><span class="va">lazy_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data_source <span class="op">=</span> <span class="va">data_source</span>,</span>
<span>    is_open <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co"># Lazy caches</span></span>
<span>    dims_cache <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    data_cache <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    mask_cache <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lazy_backend"</span>, <span class="st">"storage_backend"</span><span class="op">)</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_open.lazy_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="co"># Don't load data yet!</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_dims.lazy_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Load dimensions only when first requested</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># In practice, read just headers/metadata</span></span>
<span>    <span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      time <span class="op">=</span> <span class="fl">50</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_data.lazy_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span>, <span class="va">rows</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">cols</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Load data only when first accessed</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">data_cache</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Loading data (lazy)...\n"</span><span class="op">)</span></span>
<span>    <span class="va">backend</span><span class="op">$</span><span class="va">data_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">backend</span><span class="op">$</span><span class="va">data_cache</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span><span class="op">)</span> <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">rows</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span> <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="va">cols</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_mask.lazy_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">mask_cache</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_dims.html">backend_get_dims</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>    <span class="va">backend</span><span class="op">$</span><span class="va">mask_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="va">dims</span><span class="op">$</span><span class="va">spatial</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">mask_cache</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_close.lazy_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">dims_cache</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">data_cache</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">mask_cache</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Demonstrate lazy loading</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">lazy_backend</span><span class="op">(</span><span class="st">"source"</span><span class="op">)</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_open.html">backend_open</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Getting dimensions...\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Getting dimensions...</span></span>
<span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_dims.html">backend_get_dims</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="co"># No data loading</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nGetting mask...\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Getting mask...</span></span>
<span><span class="va">mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_mask.html">backend_get_mask</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="co"># Still no data loading</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nGetting data...\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Getting data...</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_data.html">backend_get_data</a></span><span class="op">(</span><span class="va">backend</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="co"># NOW data loads</span></span>
<span><span class="co">#&gt; Loading data (lazy)...</span></span>
<span></span>
<span><span class="fu"><a href="../reference/backend_close.html">backend_close</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="validation-pattern">Validation Pattern<a class="anchor" aria-label="anchor" href="#validation-pattern"></a>
</h3>
<p>Implement validation to ensure data integrity:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create validation utilities</span></span>
<span><span class="va">validate_backend_contract</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend_class</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">required_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"backend_open"</span>,</span>
<span>    <span class="st">"backend_close"</span>,</span>
<span>    <span class="st">"backend_get_dims"</span>,</span>
<span>    <span class="st">"backend_get_data"</span>,</span>
<span>    <span class="st">"backend_get_mask"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">missing_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">method</span> <span class="kw">in</span> <span class="va">required_methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">full_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"."</span>, <span class="va">backend_class</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="va">full_method</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">missing_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">missing_methods</span>, <span class="va">method</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">missing_methods</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span></span>
<span>      <span class="st">"Backend class '"</span>, <span class="va">backend_class</span>, <span class="st">"' missing required methods: "</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">missing_methods</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"✓ Backend class '"</span>, <span class="va">backend_class</span>, <span class="st">"' implements all required methods\n"</span><span class="op">)</span></span>
<span>  <span class="cn">TRUE</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test our backends</span></span>
<span><span class="fu">validate_backend_contract</span><span class="op">(</span><span class="st">"json_backend"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✓ Backend class ' json_backend ' implements all required methods</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu">validate_backend_contract</span><span class="op">(</span><span class="st">"lazy_backend"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✓ Backend class ' lazy_backend ' implements all required methods</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-topics">Advanced Topics<a class="anchor" aria-label="anchor" href="#advanced-topics"></a>
</h2>
<div class="section level3">
<h3 id="caching-strategies">Caching Strategies<a class="anchor" aria-label="anchor" href="#caching-strategies"></a>
</h3>
<p>Implement intelligent caching for better performance:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Advanced caching backend</span></span>
<span><span class="va">cached_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">source</span>, <span class="va">cache_size_mb</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="va">source</span>,</span>
<span>    cache_size_mb <span class="op">=</span> <span class="va">cache_size_mb</span>,</span>
<span>    is_open <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co"># Multi-level cache</span></span>
<span>    cache <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      dims <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      mask <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      data_blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      access_times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Cache statistics</span></span>
<span>    stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      hits <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      misses <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      evictions <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cached_backend"</span>, <span class="st">"storage_backend"</span><span class="op">)</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implement cache management</span></span>
<span><span class="va">cache_get_or_load</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span>, <span class="va">key</span>, <span class="va">loader_fn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">cache</span><span class="op">[[</span><span class="va">key</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">hits</span> <span class="op">&lt;-</span> <span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">hits</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Cache hit for"</span>, <span class="va">key</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">cache</span><span class="op">[[</span><span class="va">key</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">misses</span> <span class="op">&lt;-</span> <span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">misses</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Cache miss for"</span>, <span class="va">key</span>, <span class="st">"- loading...\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu">loader_fn</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">cache</span><span class="op">[[</span><span class="va">key</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">cache</span><span class="op">$</span><span class="va">access_times</span><span class="op">[[</span><span class="va">key</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">value</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_open.cached_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_dims.cached_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">cache_get_or_load</span><span class="op">(</span><span class="va">backend</span>, <span class="st">"dims"</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, time <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_data.cached_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span>, <span class="va">rows</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">cols</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create cache key based on request</span></span>
<span>  <span class="va">cache_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"data_"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">rows</span> <span class="op"><a href="../reference/grapes-or-or-grapes.html">%||%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>,</span>
<span>    <span class="st">"_"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cols</span> <span class="op"><a href="../reference/grapes-or-or-grapes.html">%||%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">cache_get_or_load</span><span class="op">(</span><span class="va">backend</span>, <span class="va">cache_key</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span><span class="op">)</span> <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">rows</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span> <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="va">cols</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_mask.cached_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">cache_get_or_load</span><span class="op">(</span><span class="va">backend</span>, <span class="st">"mask"</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_close.cached_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Report cache statistics</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCache statistics:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Hits:"</span>, <span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">hits</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Misses:"</span>, <span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">misses</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"  Hit rate:"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">hits</span> <span class="op">/</span></span>
<span>      <span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">hits</span> <span class="op">+</span> <span class="va">backend</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">misses</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Demonstrate caching</span></span>
<span><span class="va">`%||%`</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="va">y</span> <span class="kw">else</span> <span class="va">x</span></span>
<span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">cached_backend</span><span class="op">(</span><span class="st">"source"</span><span class="op">)</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_open.html">backend_open</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First access - cache miss</span></span>
<span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_data.html">backend_get_data</a></span><span class="op">(</span><span class="va">backend</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cache miss for data_1_10_1_100 - loading...</span></span>
<span></span>
<span><span class="co"># Second access - cache hit</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_data.html">backend_get_data</a></span><span class="op">(</span><span class="va">backend</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cache miss for data_1_10_1_100 - loading...</span></span>
<span></span>
<span><span class="co"># Different subset - cache miss</span></span>
<span><span class="va">data3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_data.html">backend_get_data</a></span><span class="op">(</span><span class="va">backend</span>, rows <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cache miss for data_11_20_1_100 - loading...</span></span>
<span></span>
<span><span class="fu"><a href="../reference/backend_close.html">backend_close</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cache statistics:</span></span>
<span><span class="co">#&gt;   Hits: 0 </span></span>
<span><span class="co">#&gt;   Misses: 0 </span></span>
<span><span class="co">#&gt;   Hit rate: NaN %</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h3>
<p>Robust error handling makes backends production-ready:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a backend with comprehensive error handling</span></span>
<span><span class="va">robust_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">source</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="va">source</span>,</span>
<span>    is_open <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    error_log <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"robust_backend"</span>, <span class="st">"storage_backend"</span><span class="op">)</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Helper to log errors</span></span>
<span><span class="va">log_error</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span>, <span class="va">operation</span>, <span class="va">error</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">error_log</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">error_log</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    operation <span class="op">=</span> <span class="va">operation</span>,</span>
<span>    message <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">error</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_open.robust_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Backend already open"</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="co"># Simulate potential failures</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Simulated connection failure"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Successfully opened backend\n"</span><span class="op">)</span></span>
<span>      <span class="va">backend</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">log_error</span><span class="op">(</span><span class="va">backend</span>, <span class="st">"open"</span>, <span class="va">e</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Failed to open backend: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_data.robust_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span>, <span class="va">rows</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">cols</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="co"># Validate indices</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">rows</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Invalid row indices"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">cols</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Invalid column indices"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="co"># Return data</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="va">rows</span> <span class="op"><a href="../reference/grapes-or-or-grapes.html">%||%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="va">cols</span> <span class="op"><a href="../reference/grapes-or-or-grapes.html">%||%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">log_error</span><span class="op">(</span><span class="va">backend</span>, <span class="st">"get_data"</span>, <span class="va">e</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Data access failed: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implement other methods...</span></span>
<span><span class="va">backend_get_dims.robust_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, time <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_get_mask.robust_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">backend</span><span class="op">$</span><span class="va">is_open</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Backend not open"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">backend_close.robust_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">backend</span><span class="op">$</span><span class="va">error_log</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nError log:\n"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">error</span> <span class="kw">in</span> <span class="va">backend</span><span class="op">$</span><span class="va">error_log</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>        <span class="st">"  -"</span>, <span class="va">error</span><span class="op">$</span><span class="va">operation</span>, <span class="st">"at"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">error</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span>,</span>
<span>        <span class="st">":"</span>, <span class="va">error</span><span class="op">$</span><span class="va">message</span>, <span class="st">"\n"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">backend</span><span class="op">$</span><span class="va">is_open</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test error handling</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">robust_backend</span><span class="op">(</span><span class="st">"source"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># May fail randomly</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_open.html">backend_open</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_data.html">backend_get_data</a></span><span class="op">(</span><span class="va">backend</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Data retrieved successfully\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/backend_close.html">backend_close</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Caught error:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Successfully opened backend</span></span>
<span><span class="co">#&gt; Data retrieved successfully</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="tips-and-best-practices">Tips and Best Practices<a class="anchor" aria-label="anchor" href="#tips-and-best-practices"></a>
</h2>
<p>Here are essential guidelines for creating robust, efficient
backends.</p>
<div class="section level3">
<h3 id="lazy-loading-requirements">Lazy Loading Requirements<a class="anchor" aria-label="anchor" href="#lazy-loading-requirements"></a>
</h3>
<p><strong>Implementation Pattern</strong>: - Load metadata and
dimensions during <code><a href="../reference/backend_open.html">backend_open()</a></code> - Defer data loading until
<code><a href="../reference/backend_get_data.html">backend_get_data()</a></code> invocation - Cache frequently accessed
metadata - Implement partial loading for subset requests</p>
</div>
<div class="section level3">
<h3 id="idempotency-requirements">Idempotency Requirements<a class="anchor" aria-label="anchor" href="#idempotency-requirements"></a>
</h3>
<p><strong>Method Behavior Specifications</strong>: -
<code><a href="../reference/backend_open.html">backend_open()</a></code> on open backend: Return without modification
- <code><a href="../reference/backend_close.html">backend_close()</a></code> on closed backend: Return silently - All
query methods: Return consistent results for repeated calls - State
modifications: Implement checks to prevent duplicate operations</p>
</div>
<div class="section level3">
<h3 id="caching-strategy">Caching Strategy<a class="anchor" aria-label="anchor" href="#caching-strategy"></a>
</h3>
<p><strong>Recommended Cache Targets</strong>: - Spatial masks (computed
once, used frequently) - Dimension calculations - Metadata extractions -
Subset indices for repeated queries</p>
<p>Implement cache invalidation only when underlying data changes.</p>
</div>
<div class="section level3">
<h3 id="backend-development-checklist">Backend Development Checklist<a class="anchor" aria-label="anchor" href="#backend-development-checklist"></a>
</h3>
<p>Before considering your backend complete:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">backend_checklist</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Backend Development Checklist:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Required Functionality:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Implements all 5 required methods\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Returns correct data orientations\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Handles NULL rows/cols in get_data\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Returns valid dimension structure\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Mask length matches spatial dimensions\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Robustness:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Validates inputs in constructor\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Checks is_open state in all methods\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Handles errors gracefully\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Cleans up resources in close\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Methods are idempotent\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Performance:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Implements lazy loading\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Caches frequently accessed values\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Minimizes memory footprint\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Supports partial data loading\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Documentation:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Constructor documented\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Error messages are informative\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Usage examples provided\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  ☐ Performance characteristics noted\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">backend_checklist</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Backend Development Checklist:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Required Functionality:</span></span>
<span><span class="co">#&gt;   ☐ Implements all 5 required methods</span></span>
<span><span class="co">#&gt;   ☐ Returns correct data orientations</span></span>
<span><span class="co">#&gt;   ☐ Handles NULL rows/cols in get_data</span></span>
<span><span class="co">#&gt;   ☐ Returns valid dimension structure</span></span>
<span><span class="co">#&gt;   ☐ Mask length matches spatial dimensions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Robustness:</span></span>
<span><span class="co">#&gt;   ☐ Validates inputs in constructor</span></span>
<span><span class="co">#&gt;   ☐ Checks is_open state in all methods</span></span>
<span><span class="co">#&gt;   ☐ Handles errors gracefully</span></span>
<span><span class="co">#&gt;   ☐ Cleans up resources in close</span></span>
<span><span class="co">#&gt;   ☐ Methods are idempotent</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Performance:</span></span>
<span><span class="co">#&gt;   ☐ Implements lazy loading</span></span>
<span><span class="co">#&gt;   ☐ Caches frequently accessed values</span></span>
<span><span class="co">#&gt;   ☐ Minimizes memory footprint</span></span>
<span><span class="co">#&gt;   ☐ Supports partial data loading</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Documentation:</span></span>
<span><span class="co">#&gt;   ☐ Constructor documented</span></span>
<span><span class="co">#&gt;   ☐ Error messages are informative</span></span>
<span><span class="co">#&gt;   ☐ Usage examples provided</span></span>
<span><span class="co">#&gt;   ☐ Performance characteristics noted</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-your-backend">Testing Your Backend<a class="anchor" aria-label="anchor" href="#testing-your-backend"></a>
</h3>
<p>Comprehensive testing ensures reliability:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test suite for backends</span></span>
<span><span class="va">test_backend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">backend_constructor</span>, <span class="va">test_source</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing backend implementation...\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test construction</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing construction..."</span><span class="op">)</span></span>
<span>  <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">backend_constructor</span><span class="op">(</span><span class="va">test_source</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" ✓\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test opening</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing open..."</span><span class="op">)</span></span>
<span>  <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_open.html">backend_open</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" ✓\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test dimensions</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing dimensions..."</span><span class="op">)</span></span>
<span>  <span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_dims.html">backend_get_dims</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">dims</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spatial"</span>, <span class="st">"time"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dims</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dims</span><span class="op">$</span><span class="va">spatial</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" ✓\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test mask</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing mask..."</span><span class="op">)</span></span>
<span>  <span class="va">mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_mask.html">backend_get_mask</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">is.logical</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">dims</span><span class="op">$</span><span class="va">spatial</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" ✓\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test data access</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing data access..."</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_data.html">backend_get_data</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="va">dims</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" ✓\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test subsetting</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing subsetting..."</span><span class="op">)</span></span>
<span>  <span class="va">subset_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backend_get_data.html">backend_get_data</a></span><span class="op">(</span><span class="va">backend</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">subset_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">subset_data</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" ✓\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test closing</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing close..."</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/backend_close.html">backend_close</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" ✓\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAll tests passed.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test our JSON backend</span></span>
<span><span class="fu">test_backend</span><span class="op">(</span><span class="va">json_backend</span>, <span class="va">json_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Testing backend implementation...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Testing construction... ✓</span></span>
<span><span class="co">#&gt; Testing open... ✓</span></span>
<span><span class="co">#&gt; Testing dimensions... ✓</span></span>
<span><span class="co">#&gt; Testing mask... ✓</span></span>
<span><span class="co">#&gt; Testing data access... ✓</span></span>
<span><span class="co">#&gt; Testing subsetting... ✓</span></span>
<span><span class="co">#&gt; Testing close... ✓</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All tests passed.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<p>Common issues when developing backends and their solutions.</p>
<div class="section level3">
<h3 id="dimension-mismatches">Dimension Mismatches<a class="anchor" aria-label="anchor" href="#dimension-mismatches"></a>
</h3>
<p><strong>Problem</strong>: “Error: Mask length does not match spatial
dimensions”</p>
<p><strong>Solution</strong>: Ensure
<code>length(backend_get_mask(backend))</code> equals
<code>prod(backend_get_dims(backend)$spatial)</code></p>
</div>
<div class="section level3">
<h3 id="memory-issues">Memory Issues<a class="anchor" aria-label="anchor" href="#memory-issues"></a>
</h3>
<p><strong>Problem</strong>: Large datasets cause memory errors</p>
<p><strong>Solution</strong>: Implement lazy loading and support partial
data access through row/column subsetting</p>
</div>
<div class="section level3">
<h3 id="state-management">State Management<a class="anchor" aria-label="anchor" href="#state-management"></a>
</h3>
<p><strong>Problem</strong>: “Error: Backend not open” in methods</p>
<p><strong>Solution</strong>: Always check <code>is_open</code> flag and
provide informative error messages</p>
</div>
</div>
<div class="section level2">
<h2 id="integration-with-other-vignettes">Integration with Other Vignettes<a class="anchor" aria-label="anchor" href="#integration-with-other-vignettes"></a>
</h2>
<p>This backend development guide connects to:</p>
<p><strong>Prerequisites</strong>: - <a href="fmridataset-intro.html">Getting Started</a> - Understand how
backends fit into the ecosystem - <a href="architecture-overview.html">Architecture Overview</a> - Learn the
design principles</p>
<p><strong>Next Steps</strong>: - <a href="backend-registry.html">Backend Registry</a> - Register your
backend for automatic selection - <a href="extending-backends.html">Advanced Backend Patterns</a> -
Sophisticated techniques for production backends</p>
<p><strong>Applications</strong>: - <a href="h5-backend-usage.html">H5
Backend Usage</a> - See a production backend in action</p>
</div>
<div class="section level2">
<h2 id="session-information">Session Information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] fmridataset_0.8.9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] gtable_0.3.6          xfun_0.56             bslib_0.9.0          </span></span>
<span><span class="co">#&gt;  [4] ggplot2_4.0.1         lattice_0.22-7        bigassertr_0.1.7     </span></span>
<span><span class="co">#&gt;  [7] numDeriv_2016.8-1.1   vctrs_0.7.0           tools_4.5.2          </span></span>
<span><span class="co">#&gt; [10] generics_0.1.4        stats4_4.5.2          parallel_4.5.2       </span></span>
<span><span class="co">#&gt; [13] tibble_3.3.1          pkgconfig_2.0.3       Matrix_1.7-4         </span></span>
<span><span class="co">#&gt; [16] RColorBrewer_1.1-3    bigstatsr_1.6.2       S4Vectors_0.48.0     </span></span>
<span><span class="co">#&gt; [19] S7_0.2.1              desc_1.4.3            RcppParallel_5.1.11-1</span></span>
<span><span class="co">#&gt; [22] assertthat_0.2.1      lifecycle_1.0.5       compiler_4.5.2       </span></span>
<span><span class="co">#&gt; [25] neuroim2_0.8.3        farver_2.1.2          stringr_1.6.0        </span></span>
<span><span class="co">#&gt; [28] textshaping_1.0.4     RNifti_1.9.0          bigparallelr_0.3.2   </span></span>
<span><span class="co">#&gt; [31] codetools_0.2-20      htmltools_0.5.9       sass_0.4.10          </span></span>
<span><span class="co">#&gt; [34] yaml_2.3.12           deflist_0.2.0         pillar_1.11.1        </span></span>
<span><span class="co">#&gt; [37] pkgdown_2.2.0         crayon_1.5.3          jquerylib_0.1.4      </span></span>
<span><span class="co">#&gt; [40] RNiftyReg_2.8.4       cachem_1.1.0          DelayedArray_0.36.0  </span></span>
<span><span class="co">#&gt; [43] dbscan_1.2.4          iterators_1.0.14      abind_1.4-8          </span></span>
<span><span class="co">#&gt; [46] foreach_1.5.2         tidyselect_1.2.1      digest_0.6.39        </span></span>
<span><span class="co">#&gt; [49] stringi_1.8.7         dplyr_1.1.4           purrr_1.2.1          </span></span>
<span><span class="co">#&gt; [52] splines_4.5.2         cowplot_1.2.0         fastmap_1.2.0        </span></span>
<span><span class="co">#&gt; [55] grid_4.5.2            mmap_0.6-23           SparseArray_1.10.8   </span></span>
<span><span class="co">#&gt; [58] cli_3.6.5             magrittr_2.0.4        S4Arrays_1.10.1      </span></span>
<span><span class="co">#&gt; [61] fmrihrf_0.1.0.9000    scales_1.4.0          XVector_0.50.0       </span></span>
<span><span class="co">#&gt; [64] rmarkdown_2.30        matrixStats_1.5.0     rmio_0.4.0           </span></span>
<span><span class="co">#&gt; [67] ragg_1.5.0            memoise_2.0.1         evaluate_1.0.5       </span></span>
<span><span class="co">#&gt; [70] knitr_1.51            IRanges_2.44.0        doParallel_1.0.17    </span></span>
<span><span class="co">#&gt; [73] rlang_1.1.7           Rcpp_1.1.1            glue_1.8.0           </span></span>
<span><span class="co">#&gt; [76] BiocGenerics_0.56.0   jsonlite_2.0.0        R6_2.6.1             </span></span>
<span><span class="co">#&gt; [79] MatrixGenerics_1.22.0 systemfonts_1.3.1     fs_1.6.6             </span></span>
<span><span class="co">#&gt; [82] flock_0.7</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
