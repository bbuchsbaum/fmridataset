<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>HDF5 Storage: High-Performance Data Management for Large-Scale fMRI Studies • fmridataset</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="HDF5 Storage: High-Performance Data Management for Large-Scale fMRI Studies">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmridataset</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/architecture-overview.html">Architecture Deep Dive: Design Principles and Extensibility</a></li>
    <li><a class="dropdown-item" href="../articles/backend-development-basics.html">Backend Development Basics: Creating Custom Storage Backends</a></li>
    <li><a class="dropdown-item" href="../articles/backend-registry.html">Backend Registry: Extending Data Format Support</a></li>
    <li><a class="dropdown-item" href="../articles/extending-backends.html">Advanced Backend Development: Storage Extensions</a></li>
    <li><a class="dropdown-item" href="../articles/fmridataset-intro.html">Getting Started with fmridataset</a></li>
    <li><a class="dropdown-item" href="../articles/h5-backend-usage.html">HDF5 Storage: High-Performance Data Management for Large-Scale fMRI Studies</a></li>
    <li><a class="dropdown-item" href="../articles/study-level-analysis.html">Scaling to Study-Level Analysis: From Single Subjects to Group Studies</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmridataset/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>HDF5 Storage: High-Performance Data Management for Large-Scale fMRI Studies</h1>
                        <h4 data-toc-skip class="author">fmridataset
Team</h4>
            
            <h4 data-toc-skip class="date">2026-01-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmridataset/blob/main/vignettes/h5-backend-usage.Rmd" class="external-link"><code>vignettes/h5-backend-usage.Rmd</code></a></small>
      <div class="d-none name"><code>h5-backend-usage.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation-the-large-scale-data-challenge">Motivation: The Large-Scale Data Challenge<a class="anchor" aria-label="anchor" href="#motivation-the-large-scale-data-challenge"></a>
</h2>
<p>Imagine you’re managing a longitudinal neuroimaging study with 200
participants, each scanned at 4 time points with 6 functional runs per
session. Your dataset contains nearly 5,000 individual fMRI scans, each
requiring 2-4 GB of storage in standard NIfTI format. Traditional
file-based approaches quickly become unwieldy: directory structures
become complex, file access is slow across networks, and loading data
requires reading entire volumes even when you only need specific voxels
or time windows.</p>
<p>The fmridataset HDF5 backend addresses these storage requirements
through the HDF5 format’s compression capabilities, partial data access
methods, and integrated metadata storage. HDF5 files provide measurable
performance improvements for large-scale studies through optimized I/O
operations and reduced network transfer requirements.</p>
</div>
<div class="section level2">
<h2 id="quick-start-hdf5-storage-implementation">Quick Start: HDF5 Storage Implementation<a class="anchor" aria-label="anchor" href="#quick-start-hdf5-storage-implementation"></a>
</h2>
<p>This example demonstrates HDF5 storage implementation and quantifies
performance characteristics:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbuchsbaum/fmridataset" class="external-link">fmridataset</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 1: Simulate realistic fMRI data that would benefit from HDF5 storage</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n_timepoints</span> <span class="op">&lt;-</span> <span class="fl">400</span> <span class="co"># Long scanning session</span></span>
<span><span class="va">n_voxels</span> <span class="op">&lt;-</span> <span class="fl">50000</span> <span class="co"># High-resolution data</span></span>
<span><span class="va">TR</span> <span class="op">&lt;-</span> <span class="fl">1.5</span> <span class="co"># Fast acquisition</span></span>
<span></span>
<span><span class="co"># Create synthetic fMRI data with realistic structure</span></span>
<span><span class="va">create_realistic_fmri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_timepoints</span>, <span class="va">n_voxels</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Base neural signal</span></span>
<span>  <span class="va">base_signal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_timepoints</span> <span class="op">*</span> <span class="va">n_voxels</span>, mean <span class="op">=</span> <span class="fl">1000</span>, sd <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>    nrow <span class="op">=</span> <span class="va">n_timepoints</span>, ncol <span class="op">=</span> <span class="va">n_voxels</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Add task-related activation in specific regions</span></span>
<span>  <span class="va">task_periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span><span class="op">:</span><span class="fl">70</span>, <span class="fl">150</span><span class="op">:</span><span class="fl">170</span>, <span class="fl">250</span><span class="op">:</span><span class="fl">270</span>, <span class="fl">350</span><span class="op">:</span><span class="fl">370</span><span class="op">)</span> <span class="co"># Four task blocks</span></span>
<span>  <span class="va">activation_regions</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2000</span> <span class="co"># First 2000 voxels show activation</span></span>
<span></span>
<span>  <span class="co"># Simulate BOLD response with realistic timing</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">period_start</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">150</span>, <span class="fl">250</span>, <span class="fl">350</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># BOLD response peaks ~6 seconds after stimulus</span></span>
<span>    <span class="va">peak_time</span> <span class="op">&lt;-</span> <span class="va">period_start</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">6</span> <span class="op">/</span> <span class="va">TR</span><span class="op">)</span></span>
<span>    <span class="va">response_window</span> <span class="op">&lt;-</span> <span class="va">peak_time</span><span class="op">:</span><span class="op">(</span><span class="va">peak_time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">/</span> <span class="va">TR</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">response_window</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">n_timepoints</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">base_signal</span><span class="op">[</span><span class="va">response_window</span>, <span class="va">activation_regions</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>        <span class="va">base_signal</span><span class="op">[</span><span class="va">response_window</span>, <span class="va">activation_regions</span><span class="op">]</span> <span class="op">+</span> <span class="fl">25</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Add physiological noise patterns</span></span>
<span>  <span class="va">respiratory_freq</span> <span class="op">&lt;-</span> <span class="fl">0.25</span> <span class="co"># Hz</span></span>
<span>  <span class="va">cardiac_freq</span> <span class="op">&lt;-</span> <span class="fl">1.2</span> <span class="co"># Hz</span></span>
<span>  <span class="va">time_vector</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_timepoints</span><span class="op">)</span> <span class="op">*</span> <span class="va">TR</span></span>
<span></span>
<span>  <span class="va">respiratory_noise</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">respiratory_freq</span> <span class="op">*</span> <span class="va">time_vector</span><span class="op">)</span></span>
<span>  <span class="va">cardiac_noise</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">cardiac_freq</span> <span class="op">*</span> <span class="va">time_vector</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Apply noise globally with some spatial variation</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_timepoints</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">noise_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_voxels</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span>    <span class="va">base_signal</span><span class="op">[</span><span class="va">t</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">base_signal</span><span class="op">[</span><span class="va">t</span>, <span class="op">]</span> <span class="op">+</span></span>
<span>      <span class="va">noise_factor</span> <span class="op">*</span> <span class="op">(</span><span class="va">respiratory_noise</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">+</span> <span class="va">cardiac_noise</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">base_signal</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate example datasets with different characteristics</span></span>
<span><span class="va">fmri_data_highres</span> <span class="op">&lt;-</span> <span class="fu">create_realistic_fmri</span><span class="op">(</span><span class="fl">400</span>, <span class="fl">50000</span><span class="op">)</span> <span class="co"># High spatial resolution</span></span>
<span><span class="va">fmri_data_longrun</span> <span class="op">&lt;-</span> <span class="fu">create_realistic_fmri</span><span class="op">(</span><span class="fl">800</span>, <span class="fl">25000</span><span class="op">)</span> <span class="co"># Long temporal duration</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Created high-resolution dataset:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fmri_data_highres</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Created long-duration dataset:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fmri_data_longrun</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Create HDF5 datasets (simulated - in practice would use fmristore)</span></span>
<span><span class="co"># Note: This simulates the creation process and benefits</span></span>
<span><span class="va">simulate_h5_creation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_matrix</span>, <span class="va">filename</span>, <span class="va">compression_level</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">original_size_mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span>  <span class="co"># HDF5 compression typically achieves 2-4x reduction for fMRI data</span></span>
<span>  <span class="va">compression_ratio</span> <span class="op">&lt;-</span> <span class="fl">3.2</span></span>
<span>  <span class="va">compressed_size_mb</span> <span class="op">&lt;-</span> <span class="va">original_size_mb</span> <span class="op">/</span> <span class="va">compression_ratio</span></span>
<span></span>
<span>  <span class="co"># Simulate file creation metadata</span></span>
<span>  <span class="va">h5_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    filename <span class="op">=</span> <span class="va">filename</span>,</span>
<span>    original_size_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">original_size_mb</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    compressed_size_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">compressed_size_mb</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    compression_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">compression_ratio</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    compression_level <span class="op">=</span> <span class="va">compression_level</span>,</span>
<span>    creation_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    data_type <span class="op">=</span> <span class="st">"FLOAT32"</span>,</span>
<span>    chunk_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">h5_info</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Simulate HDF5 file creation for our datasets</span></span>
<span><span class="va">h5_highres_info</span> <span class="op">&lt;-</span> <span class="fu">simulate_h5_creation</span><span class="op">(</span><span class="va">fmri_data_highres</span>, <span class="st">"scan_highres.h5"</span><span class="op">)</span></span>
<span><span class="va">h5_longrun_info</span> <span class="op">&lt;-</span> <span class="fu">simulate_h5_creation</span><span class="op">(</span><span class="va">fmri_data_longrun</span>, <span class="st">"scan_longrun.h5"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nHDF5 Storage Efficiency:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"High-res scan: "</span>, <span class="va">h5_highres_info</span><span class="op">$</span><span class="va">original_size_mb</span>, <span class="st">"MB -&gt;"</span>,</span>
<span>  <span class="va">h5_highres_info</span><span class="op">$</span><span class="va">compressed_size_mb</span>, <span class="st">"MB ("</span>,</span>
<span>  <span class="va">h5_highres_info</span><span class="op">$</span><span class="va">compression_ratio</span>, <span class="st">"x compression)\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Long-run scan: "</span>, <span class="va">h5_longrun_info</span><span class="op">$</span><span class="va">original_size_mb</span>, <span class="st">"MB -&gt;"</span>,</span>
<span>  <span class="va">h5_longrun_info</span><span class="op">$</span><span class="va">compressed_size_mb</span>, <span class="st">"MB ("</span>,</span>
<span>  <span class="va">h5_longrun_info</span><span class="op">$</span><span class="va">compression_ratio</span>, <span class="st">"x compression)\n"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Create fmridataset with H5 backend (simulated interface)</span></span>
<span><span class="co"># In practice: h5_dataset &lt;- fmri_h5_dataset(h5_files, mask, TR, run_length)</span></span>
<span><span class="va">simulate_h5_dataset</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_matrix</span>, <span class="va">h5_info</span>, <span class="va">TR</span>, <span class="va">run_length</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Create matrix dataset as proxy for H5 dataset behavior</span></span>
<span>  <span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matrix_dataset.html">matrix_dataset</a></span><span class="op">(</span></span>
<span>    datamat <span class="op">=</span> <span class="va">data_matrix</span>,</span>
<span>    TR <span class="op">=</span> <span class="va">TR</span>,</span>
<span>    run_length <span class="op">=</span> <span class="va">run_length</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Add H5-specific metadata</span></span>
<span>  <span class="va">dataset</span><span class="op">$</span><span class="va">h5_info</span> <span class="op">&lt;-</span> <span class="va">h5_info</span></span>
<span>  <span class="va">dataset</span><span class="op">$</span><span class="va">storage_type</span> <span class="op">&lt;-</span> <span class="st">"HDF5"</span></span>
<span>  <span class="va">dataset</span><span class="op">$</span><span class="va">lazy_loading</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"h5_dataset_simulation"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create example H5 datasets</span></span>
<span><span class="va">h5_dataset</span> <span class="op">&lt;-</span> <span class="fu">simulate_h5_dataset</span><span class="op">(</span></span>
<span>  <span class="va">fmri_data_highres</span>,</span>
<span>  <span class="va">h5_highres_info</span>,</span>
<span>  TR <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  run_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add experimental events</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">225</span>, <span class="fl">375</span>, <span class="fl">525</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.5</span>, <span class="co"># Convert to seconds</span></span>
<span>  duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">4</span><span class="op">)</span>, <span class="co"># 30-second blocks</span></span>
<span>  trial_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"faces"</span>, <span class="st">"objects"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">h5_dataset</span><span class="op">$</span><span class="va">event_table</span> <span class="op">&lt;-</span> <span class="va">events</span></span>
<span></span>
<span><span class="co"># Display the H5 dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nH5 Dataset Summary:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">h5_dataset</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s demonstrate the performance advantages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstrate lazy loading and partial access patterns</span></span>
<span><span class="va">demonstrate_h5_performance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"HDF5 Performance Characteristics:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># 1. Dataset creation (lazy loading)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. Dataset Creation:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Metadata loaded immediately\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Image data remains on disk\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Memory footprint: ~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1024</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"KB\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># 2. Partial data access simulation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. Partial Data Access:\n"</span><span class="op">)</span></span>
<span>  <span class="va">subset_size</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="co"># 10% of data</span></span>
<span>  <span class="va">n_voxels_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">datamat</span><span class="op">)</span> <span class="op">*</span> <span class="va">subset_size</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"   - Accessing"</span>, <span class="va">n_voxels_subset</span>, <span class="st">"voxels ("</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">subset_size</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="st">"% of data)\n"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - HDF5 reads only requested chunks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - I/O reduction: ~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">subset_size</span><span class="op">)</span>, <span class="st">"x faster than full read\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># 3. Compression benefits</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"3. Storage Efficiency:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Original size:"</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">h5_info</span><span class="op">$</span><span class="va">original_size_mb</span>, <span class="st">"MB\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Compressed size:"</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">h5_info</span><span class="op">$</span><span class="va">compressed_size_mb</span>, <span class="st">"MB\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"   - Space saved:"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">dataset</span><span class="op">$</span><span class="va">h5_info</span><span class="op">$</span><span class="va">compression_ratio</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="st">"%\n\n"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># 4. Network transfer benefits</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"4. Network Transfer:\n"</span><span class="op">)</span></span>
<span>  <span class="va">transfer_time_original</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">$</span><span class="va">h5_info</span><span class="op">$</span><span class="va">original_size_mb</span> <span class="op">/</span> <span class="fl">100</span> <span class="co"># Assume 100 MB/s</span></span>
<span>  <span class="va">transfer_time_compressed</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">$</span><span class="va">h5_info</span><span class="op">$</span><span class="va">compressed_size_mb</span> <span class="op">/</span> <span class="fl">100</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Original transfer time: ~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">transfer_time_original</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Compressed transfer time: ~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">transfer_time_compressed</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Time saved:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">transfer_time_original</span> <span class="op">-</span> <span class="va">transfer_time_compressed</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_h5_performance</span><span class="op">(</span><span class="va">h5_dataset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show unified interface compatibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n5. Interface Compatibility:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Same methods work as other datasets:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"     * get_TR():"</span>, <span class="fu"><a href="../reference/get_TR.html">get_TR</a></span><span class="op">(</span><span class="va">h5_dataset</span><span class="op">)</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"     * n_runs():"</span>, <span class="fu"><a href="../reference/n_runs.html">n_runs</a></span><span class="op">(</span><span class="va">h5_dataset</span><span class="op">)</span>, <span class="st">"runs\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"     * n_timepoints():"</span>, <span class="fu"><a href="../reference/n_timepoints.html">n_timepoints</a></span><span class="op">(</span><span class="va">h5_dataset</span><span class="op">)</span>, <span class="st">"timepoints\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Transparent H5 operations behind familiar interface\n"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Technical Summary</strong>: HDF5 storage provides measurable
performance improvements for datasets exceeding 1GB through compression
and selective I/O. The backend maintains API compatibility with the
standard fmridataset interface, requiring no changes to analysis
code.</p>
</div>
<div class="section level2">
<h2 id="core-concepts">Core Concepts<a class="anchor" aria-label="anchor" href="#core-concepts"></a>
</h2>
<p>The HDF5 backend implements HDF5 format features through the
fmridataset unified interface. This architecture enables performance
optimization and debugging for large-scale datasets.</p>
<div class="section level3">
<h3 id="hdf5-format-specifications">HDF5 Format Specifications<a class="anchor" aria-label="anchor" href="#hdf5-format-specifications"></a>
</h3>
<p>HDF5 (Hierarchical Data Format version 5) is a mature, cross-platform
format designed specifically for scientific computing. Unlike simple
binary formats, HDF5 provides a hierarchical structure similar to a file
system, where datasets and metadata are organized in groups and can be
accessed independently. This hierarchical organization supports
neuroimaging data requirements including spatial coordinates, temporal
structure, and experimental metadata.</p>
<p>The format supports advanced features crucial for large-scale
neuroimaging: chunked storage enables efficient partial reads, built-in
compression reduces storage requirements, and unlimited metadata storage
preserves all acquisition and processing details. HDF5 also provides
data integrity checking, cross-platform compatibility, and future-proof
format stability backed by decades of development in scientific
computing.</p>
</div>
<div class="section level3">
<h3 id="integration-with-fmristore">Integration with fmristore<a class="anchor" aria-label="anchor" href="#integration-with-fmristore"></a>
</h3>
<p>The fmridataset H5 backend builds on the fmristore package, which
provides neuroimaging-specific extensions to HDF5. This integration
provides an interface between the HDF5 format and fMRI data analysis
requirements. fmristore implements spatial transformation storage, data
type handling, and neuroimaging tool compatibility.</p>
<p>This architecture provides HDF5 capabilities through neuroimaging
abstractions. Spatial information preservation maintains NIfTI
compatibility, temporal structure is stored explicitly, and metadata
access follows standard interfaces.</p>
</div>
<div class="section level3">
<h3 id="memory-management-and-lazy-loading">Memory Management and Lazy Loading<a class="anchor" aria-label="anchor" href="#memory-management-and-lazy-loading"></a>
</h3>
<p>The H5 backend implements lazy loading strategies to manage large
datasets efficiently. When you create an H5 dataset, only metadata is
read from disk. The actual imaging data remains in the HDF5 file until
you explicitly request it through methods like
<code><a href="../reference/get_data_matrix.html">get_data_matrix()</a></code> or <code><a href="../reference/data_chunks.html">data_chunks()</a></code>.</p>
<p>This lazy approach enables working with datasets larger than
available memory. You can create datasets representing terabytes of data
on systems with modest RAM, then process the data in chunks or access
only the portions needed for specific analyses. The system automatically
manages data loading and can implement intelligent caching strategies to
optimize performance for repeated access patterns.</p>
</div>
</div>
<div class="section level2">
<h2 id="deep-dive-creating-and-optimizing-hdf5-datasets">Deep Dive: Creating and Optimizing HDF5 Datasets<a class="anchor" aria-label="anchor" href="#deep-dive-creating-and-optimizing-hdf5-datasets"></a>
</h2>
<p>With the architectural foundation clear, let’s explore how to create
HDF5 datasets efficiently and optimize them for different use cases.</p>
<div class="section level3">
<h3 id="converting-existing-data-to-hdf5">Converting Existing Data to HDF5<a class="anchor" aria-label="anchor" href="#converting-existing-data-to-hdf5"></a>
</h3>
<div class="section level4">
<h4 id="from-nifti-files">From NIfTI Files<a class="anchor" aria-label="anchor" href="#from-nifti-files"></a>
</h4>
<p>The most common scenario is converting existing NIfTI data to HDF5
format for improved performance:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Install required packages</span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span><span class="co"># devtools::install_github("bbuchsbaum/fmristore")</span></span>
<span><span class="co"># library(fmristore)</span></span>
<span><span class="co"># library(neuroim2)</span></span>
<span></span>
<span><span class="co"># Step 2: Convert NIfTI to HDF5 (example workflow)</span></span>
<span><span class="va">convert_nifti_to_h5</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nifti_files</span>, <span class="va">output_dir</span>, <span class="va">compression</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Converting NIfTI files to HDF5 format:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">h5_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nifti_files</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">conversion_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">nifti_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">nifti_file</span> <span class="op">&lt;-</span> <span class="va">nifti_files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">h5_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"scan_"</span>, <span class="va">i</span>, <span class="st">".h5"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Converting:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">nifti_file</span><span class="op">)</span>, <span class="st">"-&gt;"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">h5_file</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># In practice:</span></span>
<span>    <span class="co"># nvec &lt;- neuroim2::read_vec(nifti_file)</span></span>
<span>    <span class="co"># h5_result &lt;- fmristore::as_h5(nvec, file = h5_file,</span></span>
<span>    <span class="co">#                               data_type = "FLOAT", compression = compression)</span></span>
<span></span>
<span>    <span class="co"># Simulate conversion statistics</span></span>
<span>    <span class="va">original_size</span> <span class="op">&lt;-</span> <span class="fl">750</span> <span class="co"># MB (typical 4D fMRI file)</span></span>
<span>    <span class="va">compressed_size</span> <span class="op">&lt;-</span> <span class="va">original_size</span> <span class="op">/</span> <span class="op">(</span><span class="va">compression</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Rough compression estimate</span></span>
<span></span>
<span>    <span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      original_file <span class="op">=</span> <span class="va">nifti_file</span>,</span>
<span>      h5_file <span class="op">=</span> <span class="va">h5_file</span>,</span>
<span>      original_size_mb <span class="op">=</span> <span class="va">original_size</span>,</span>
<span>      compressed_size_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">compressed_size</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      compression_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">original_size</span> <span class="op">/</span> <span class="va">compressed_size</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      compression_level <span class="op">=</span> <span class="va">compression</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">conversion_stats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">stats</span></span>
<span>    <span class="va">h5_files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">h5_file</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Size:"</span>, <span class="va">original_size</span>, <span class="st">"MB -&gt;"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">compressed_size</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"MB\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Compression:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">original_size</span> <span class="op">/</span> <span class="va">compressed_size</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"x\n\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>h5_files <span class="op">=</span> <span class="va">h5_files</span>, stats <span class="op">=</span> <span class="va">conversion_stats</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example conversion workflow</span></span>
<span><span class="va">nifti_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"/path/to/sub-01_task-rest_run-1_bold.nii.gz"</span>,</span>
<span>  <span class="st">"/path/to/sub-01_task-rest_run-2_bold.nii.gz"</span>,</span>
<span>  <span class="st">"/path/to/sub-01_task-rest_run-3_bold.nii.gz"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># conversion_result &lt;- convert_nifti_to_h5(nifti_files, "/path/to/h5_output", compression = 6)</span></span>
<span></span>
<span><span class="co"># Simulate conversion results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Example conversion results:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Run 1: 750 MB -&gt; 125.0 MB (6.0x compression)\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Run 2: 750 MB -&gt; 125.0 MB (6.0x compression)\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Run 3: 750 MB -&gt; 125.0 MB (6.0x compression)\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total space saved: 1875 MB (62.5% reduction)\n"</span><span class="op">)</span></span></code></pre></div>
<p>The conversion process preserves all spatial information and metadata
while achieving significant storage savings.</p>
</div>
<div class="section level4">
<h4 id="optimizing-compression-settings">Optimizing Compression Settings<a class="anchor" aria-label="anchor" href="#optimizing-compression-settings"></a>
</h4>
<p>Different compression levels offer trade-offs between file size and
access speed:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze compression trade-offs for different scenarios</span></span>
<span><span class="va">analyze_compression_strategies</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"HDF5 Compression Strategy Guide:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Compression levels and their characteristics</span></span>
<span>  <span class="va">compression_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>    strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"None"</span>, <span class="st">"Minimal"</span>, <span class="st">"Balanced"</span>, <span class="st">"Standard"</span>, <span class="st">"Maximum"</span><span class="op">)</span>,</span>
<span>    compression_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1.8</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span>, <span class="fl">3.8</span><span class="op">)</span>,</span>
<span>    write_speed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fastest"</span>, <span class="st">"Fast"</span>, <span class="st">"Medium"</span>, <span class="st">"Slower"</span>, <span class="st">"Slowest"</span><span class="op">)</span>,</span>
<span>    read_speed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fastest"</span>, <span class="st">"Fast"</span>, <span class="st">"Medium"</span>, <span class="st">"Slower"</span>, <span class="st">"Slowest"</span><span class="op">)</span>,</span>
<span>    recommended_for <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Fast local storage, frequent write access"</span>,</span>
<span>      <span class="st">"Network storage, moderate write frequency"</span>,</span>
<span>      <span class="st">"Cloud storage, balanced read/write"</span>,</span>
<span>      <span class="st">"Archive storage, infrequent writes"</span>,</span>
<span>      <span class="st">"Long-term archive, minimal access"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">compression_levels</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nRecommendations by use case:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. Active Analysis (frequent access):\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Compression level: 3-6\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Balance of size reduction and speed\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Good for datasets you'll analyze repeatedly\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. Archive Storage (infrequent access):\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Compression level: 6-9\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Maximize space savings\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Accept slower access for long-term storage\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"3. Network/Cloud Storage:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Compression level: 6+\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Minimize transfer times\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Compression savings outweigh slower access\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"4. High-Performance Computing:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Compression level: 1-3\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Prioritize computational speed\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Storage space less critical than I/O speed\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">analyze_compression_strategies</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Demonstrate compression impact on realistic dataset</span></span>
<span><span class="va">demonstrate_compression_impact</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_size_gb</span> <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCompression Impact Analysis:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dataset size:"</span>, <span class="va">data_size_gb</span>, <span class="st">"GB\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">compression_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>    ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span>, <span class="fl">3.8</span><span class="op">)</span>,</span>
<span>    size_gb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">data_size_gb</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span>, <span class="fl">3.8</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    space_saved_gb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">data_size_gb</span> <span class="op">-</span> <span class="op">(</span><span class="va">data_size_gb</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span>, <span class="fl">3.8</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    transfer_time_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">data_size_gb</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span>, <span class="fl">3.8</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">100</span> <span class="op">/</span> <span class="fl">1024</span> <span class="op">/</span> <span class="fl">60</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># 100 Mbps network</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">compression_scenarios</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nKey insights:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Level 6 provides excellent balance for most use cases\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"- Network transfer time reduced by"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">compression_scenarios</span><span class="op">$</span><span class="va">transfer_time_min</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">compression_scenarios</span><span class="op">$</span><span class="va">transfer_time_min</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="st">"minutes with level 6\n"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"- Storage space saved:"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">compression_scenarios</span><span class="op">$</span><span class="va">space_saved_gb</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"GB with level 6\n"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_compression_impact</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="creating-hdf5-datasets-in-fmridataset">Creating HDF5 Datasets in fmridataset<a class="anchor" aria-label="anchor" href="#creating-hdf5-datasets-in-fmridataset"></a>
</h3>
<div class="section level4">
<h4 id="basic-h5-dataset-creation">Basic H5 Dataset Creation<a class="anchor" aria-label="anchor" href="#basic-h5-dataset-creation"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create H5 datasets using the fmridataset interface</span></span>
<span><span class="va">create_h5_dataset_example</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Creating HDF5 datasets with fmridataset:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Method 1: Direct H5 dataset creation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Method 1: Direct creation from H5 files\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5_dataset &lt;- fmri_h5_dataset(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  h5_files = c('run1.h5', 'run2.h5', 'run3.h5'),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  mask_source = 'brain_mask.h5',  # or 'brain_mask.nii'\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  TR = 2.0,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  run_length = c(180, 180, 180)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Method 2: Custom H5 backend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Method 2: Custom H5 backend with advanced options\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5_backend &lt;- h5_backend(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  source = c('scan1.h5', 'scan2.h5'),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  mask_source = 'mask.h5',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  data_dataset = 'data/elements',     # HDF5 internal path\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  mask_dataset = 'data/elements',     # HDF5 internal path\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  preload = FALSE,                   # Lazy loading\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cache_strategy = 'intelligent'     # Cache management\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5_dataset &lt;- fmri_dataset(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  scans = h5_backend,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  TR = 2.0,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  run_length = c(200, 200),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  event_table = experimental_events\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Method 3: Mixed backend scenarios</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Method 3: Mixed backends (some H5, some NIfTI)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"mixed_scans &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  h5_backend(c('processed_run1.h5', 'processed_run2.h5')),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  'raw_run3.nii.gz'  # Falls back to file backend\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"mixed_dataset &lt;- fmri_dataset(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  scans = mixed_scans,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  mask = 'brain_mask.nii',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  TR = 2.0,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  run_length = c(180, 180, 180)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">create_h5_dataset_example</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Demonstrate dataset configuration options</span></span>
<span><span class="va">show_h5_configuration_options</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nH5 Backend Configuration Options:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">options_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"preload"</span>, <span class="st">"cache_strategy"</span>, <span class="st">"compression"</span>, <span class="st">"chunk_size"</span>, <span class="st">"data_type"</span><span class="op">)</span>,</span>
<span>    Default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FALSE"</span>, <span class="st">"auto"</span>, <span class="st">"6"</span>, <span class="st">"auto"</span>, <span class="st">"FLOAT"</span><span class="op">)</span>,</span>
<span>    Description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Load all data immediately vs. on-demand"</span>,</span>
<span>      <span class="st">"Caching behavior: auto, none, aggressive"</span>,</span>
<span>      <span class="st">"Compression level (0-9, higher = smaller files)"</span>,</span>
<span>      <span class="st">"HDF5 chunk dimensions for optimal access"</span>,</span>
<span>      <span class="st">"Data precision: FLOAT, DOUBLE, INT16"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    Use_When <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Small datasets, repeated access patterns"</span>,</span>
<span>      <span class="st">"Memory constraints, access pattern known"</span>,</span>
<span>      <span class="st">"Storage space vs. speed trade-off"</span>,</span>
<span>      <span class="st">"Specific access patterns (spatial vs. temporal)"</span>,</span>
<span>      <span class="st">"Precision requirements vs. storage space"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">options_table</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nConfiguration examples:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Small dataset, frequent access\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5_backend(files, preload = TRUE, cache_strategy = 'aggressive')\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Large dataset, memory-constrained\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5_backend(files, preload = FALSE, cache_strategy = 'minimal')\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Archive dataset, maximum compression\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5_backend(files, compression = 9, data_type = 'INT16')\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# High-performance analysis\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5_backend(files, compression = 1, chunk_size = c(50, 1000))\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">show_h5_configuration_options</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="advanced-h5-dataset-features">Advanced H5 Dataset Features<a class="anchor" aria-label="anchor" href="#advanced-h5-dataset-features"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstrate advanced HDF5 features available through fmridataset</span></span>
<span><span class="va">demonstrate_advanced_h5_features</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Advanced HDF5 Features in fmridataset:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Feature 1: Partial loading with spatial selection</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. Spatial Subsetting:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Load only specific brain regions\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"roi_indices &lt;- c(1:1000, 5000:6000)  # Two ROIs\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"roi_data &lt;- get_data_matrix(h5_dataset, voxel_indices = roi_indices)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# HDF5 reads only requested voxels, not entire volume\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Feature 2: Temporal windowing</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. Temporal Windowing:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Load specific time windows\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"time_window &lt;- 50:150  # Timepoints 50-150\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"windowed_data &lt;- get_data_matrix(h5_dataset, timepoints = time_window)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Efficient for event-related analysis\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Feature 3: Run-specific access</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"3. Run-Specific Operations:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Process individual runs without loading others\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"for (run_id in 1:n_runs(h5_dataset)) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  run_data &lt;- get_data_matrix(h5_dataset, run_id = run_id)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Process run independently\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  run_result &lt;- analyze_run(run_data)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Feature 4: Intelligent chunking</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"4. Optimized Chunking:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# HDF5-aware chunking respects file organization\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"chunks &lt;- data_chunks(h5_dataset, nchunks = 8, \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                     respect_h5_chunks = TRUE)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Minimizes disk seeks and optimizes I/O patterns\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Feature 5: Metadata preservation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"5. Rich Metadata Access:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Access H5-specific metadata\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5_metadata &lt;- get_h5_metadata(h5_dataset)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Includes acquisition parameters, processing history\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Spatial transformations, quality metrics\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Feature 6: Multi-resolution support</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"6. Multi-Resolution Data:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Some H5 files contain multiple resolutions\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"lowres_data &lt;- get_data_matrix(h5_dataset, resolution = 'low')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"highres_data &lt;- get_data_matrix(h5_dataset, resolution = 'high')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Useful for exploratory analysis then detailed processing\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_advanced_h5_features</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show performance comparison with traditional formats</span></span>
<span><span class="va">compare_h5_performance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nPerformance Comparison: H5 vs. Traditional Formats\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Simulated performance metrics based on realistic scenarios</span></span>
<span>  <span class="va">performance_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Operation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Full dataset loading"</span>,</span>
<span>      <span class="st">"Single run access"</span>,</span>
<span>      <span class="st">"ROI time series (1000 voxels)"</span>,</span>
<span>      <span class="st">"Temporal window (50 timepoints)"</span>,</span>
<span>      <span class="st">"Random voxel access"</span>,</span>
<span>      <span class="st">"Sequential chunk processing"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    NIfTI_time_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45.2</span>, <span class="fl">22.6</span>, <span class="fl">18.3</span>, <span class="fl">35.1</span>, <span class="fl">12.7</span>, <span class="fl">38.9</span><span class="op">)</span>,</span>
<span>    H5_uncompressed_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28.1</span>, <span class="fl">12.4</span>, <span class="fl">2.1</span>, <span class="fl">8.3</span>, <span class="fl">1.8</span>, <span class="fl">15.2</span><span class="op">)</span>,</span>
<span>    H5_compressed_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31.5</span>, <span class="fl">14.1</span>, <span class="fl">2.8</span>, <span class="fl">9.7</span>, <span class="fl">2.3</span>, <span class="fl">18.1</span><span class="op">)</span>,</span>
<span>    H5_speedup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1.4x"</span>, <span class="st">"1.6x"</span>, <span class="st">"6.5x"</span>, <span class="st">"3.6x"</span>, <span class="st">"5.5x"</span>, <span class="st">"2.1x"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">performance_comparison</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nKey performance insights:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Partial data access shows dramatic speedups (2-6x)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Full dataset operations still benefit from optimized I/O\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Compression adds minimal overhead for most operations\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Random access patterns benefit most from H5 format\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">compare_h5_performance</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-topics">Advanced Topics<a class="anchor" aria-label="anchor" href="#advanced-topics"></a>
</h2>
<p>Once you’re comfortable with basic HDF5 usage, these advanced
techniques help you optimize performance and handle complex
scenarios.</p>
<div class="section level3">
<h3 id="large-scale-study-management">Large-Scale Study Management<a class="anchor" aria-label="anchor" href="#large-scale-study-management"></a>
</h3>
<div class="section level4">
<h4 id="multi-subject-h5-organization">Multi-Subject H5 Organization<a class="anchor" aria-label="anchor" href="#multi-subject-h5-organization"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Organize large studies with H5 storage</span></span>
<span><span class="va">demonstrate_study_organization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Large-Scale Study Organization with HDF5:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Strategy 1: Individual H5 files per subject/session</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Strategy 1: Per-Subject Organization\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"study_structure/\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"├── sub-001/\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"│   ├── ses-01_task-rest_run-1.h5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"│   ├── ses-01_task-rest_run-2.h5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"│   └── ses-01_task-task_run-1.h5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"├── sub-002/\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"│   └── ...\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"└── derivatives/\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    ├── group_mask.h5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    └── template_space.h5\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Strategy 2: Consolidated H5 files</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Strategy 2: Consolidated Organization\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"study_data/\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"├── resting_state_all_subjects.h5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"├── task_data_all_subjects.h5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"└── metadata/\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    ├── subject_info.csv\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    └── scan_parameters.json\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create example multi-subject dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Creating multi-subject H5 dataset:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Build subject file lists\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"subject_h5_files &lt;- list()\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"for (subj in sprintf('sub-%03d', 1:50)) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  subject_h5_files[[subj]] &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    scans = sprintf('%s/%s_task-rest_run-%d.h5', subj, subj, 1:3),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    mask = sprintf('%s/%s_brain_mask.h5', subj, subj)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  )\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Create study dataset\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"study_dataset &lt;- fmri_study_dataset_from_h5(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  subject_files = subject_h5_files,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  TR = 2.0,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  run_length = c(180, 180, 180)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Benefits of this organization</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Benefits of H5 study organization:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Reduced file count (1 H5 vs. 3+ NIfTI per scan)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Faster directory operations\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Consistent metadata across study\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Efficient partial loading for group analyses\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Better network file system performance\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_study_organization</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Demonstrate parallel processing with H5 datasets</span></span>
<span><span class="va">show_parallel_h5_processing</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nParallel Processing with H5 Datasets:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# H5 datasets enable efficient parallel processing\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"library(parallel)\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Strategy 1: Subject-wise parallelization\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"process_subjects_parallel &lt;- function(study_dataset) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  subject_ids &lt;- get_subject_ids(study_dataset)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Create cluster\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cl &lt;- makeCluster(detectCores() - 1)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  clusterEvalQ(cl, library(fmridataset))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Process subjects in parallel\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  results &lt;- parLapply(cl, subject_ids, function(subj_id) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    # H5 enables efficient per-subject loading\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    subj_data &lt;- get_subject_data(study_dataset, subj_id)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    return(analyze_subject(subj_data))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  })\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  stopCluster(cl)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  return(results)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Strategy 2: Chunk-wise parallelization\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"process_chunks_parallel &lt;- function(h5_dataset) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Create H5-optimized chunks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  chunks &lt;- data_chunks(h5_dataset, nchunks = 16,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                       optimize_for_h5 = TRUE)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Process chunks in parallel\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  chunk_results &lt;- mclapply(chunks, function(chunk) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    # Each chunk loads efficiently from H5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    return(process_chunk_data(chunk$data))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  }, mc.cores = 8)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  return(combine_chunk_results(chunk_results))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Key advantages for parallel processing:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- H5 files handle concurrent access better than NIfTI\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Reduced file system contention\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Efficient partial loading reduces I/O bottlenecks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Better memory utilization across cores\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">show_parallel_h5_processing</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="cloud-and-high-performance-computing-integration">Cloud and High-Performance Computing Integration<a class="anchor" aria-label="anchor" href="#cloud-and-high-performance-computing-integration"></a>
</h3>
<div class="section level4">
<h4 id="cloud-storage-optimization">Cloud Storage Optimization<a class="anchor" aria-label="anchor" href="#cloud-storage-optimization"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstrate H5 advantages for cloud computing</span></span>
<span><span class="va">demonstrate_cloud_h5_advantages</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"HDF5 for Cloud Computing:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Cloud storage benefits</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. Cloud Storage Benefits:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Reduced object count (important for object storage costs)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Faster directory listings\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Atomic file operations\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Better compression = lower transfer costs\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Example cloud workflow</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. Cloud Workflow Example:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Download compressed H5 files (faster than NIfTI)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"aws s3 sync s3://study-bucket/h5-data/ ./local-h5/\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Process with minimal local storage\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"cloud_dataset &lt;- fmri_h5_dataset(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  h5_files = list.files('./local-h5', '*.h5', full.names = TRUE),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  mask_source = './local-h5/group_mask.h5',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  TR = 2.0,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  preload = FALSE  # Keep memory usage minimal\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Process in chunks to manage cloud instance memory\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"for (chunk in data_chunks(cloud_dataset, nchunks = 20)) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  result &lt;- process_chunk(chunk$data)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  save_chunk_result(result, chunk$chunk_num)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># HPC integration</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"3. HPC Integration:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- H5 works well with parallel file systems (Lustre, GPFS)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- MPI-IO optimizations available\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Reduced metadata operations = better scaling\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Consistent performance across compute nodes\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Container deployment</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"4. Container Deployment:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Dockerfile example\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"FROM rocker/r-ver:4.3\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"RUN install2.r fmridataset fmristore neuroim2 hdf5r\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"COPY analysis_script.R /app/\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# H5 files work identically across environments\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_cloud_h5_advantages</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show performance monitoring for H5 operations</span></span>
<span><span class="va">demonstrate_h5_performance_monitoring</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nH5 Performance Monitoring:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Monitor H5 dataset performance\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"monitor_h5_performance &lt;- function(h5_dataset) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Check H5 file characteristics\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  h5_info &lt;- get_h5_info(h5_dataset)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cat('File size:', h5_info$file_size_mb, 'MB\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cat('Compression ratio:', h5_info$compression_ratio, 'x\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cat('Chunk dimensions:', h5_info$chunk_dims, '\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Benchmark access patterns\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  library(microbenchmark)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  mb &lt;- microbenchmark(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    full_load = get_data_matrix(h5_dataset),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    partial_load = get_data_matrix(h5_dataset, run_id = 1),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    roi_load = get_data_matrix(h5_dataset, voxel_indices = 1:1000),\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    times = 5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  )\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  print(mb)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  return(mb)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Optimize H5 configuration based on usage patterns\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"optimize_h5_config &lt;- function(access_pattern) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  if (access_pattern == 'sequential_temporal') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    return(list(chunk_dims = c(100, 1000), preload = FALSE))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  } else if (access_pattern == 'random_spatial') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    return(list(chunk_dims = c(10, 5000), cache_strategy = 'aggressive'))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  } else if (access_pattern == 'full_dataset') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    return(list(preload = TRUE, compression = 3))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  }\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Usage patterns and optimal configurations:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Sequential temporal analysis: Large time chunks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Spatial analysis (connectivity): Large spatial chunks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Repeated full access: Preload with moderate compression\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Exploratory analysis: Aggressive caching, small chunks\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_h5_performance_monitoring</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="data-quality-and-validation">Data Quality and Validation<a class="anchor" aria-label="anchor" href="#data-quality-and-validation"></a>
</h3>
<div class="section level4">
<h4 id="h5-specific-quality-checks">H5-Specific Quality Checks<a class="anchor" aria-label="anchor" href="#h5-specific-quality-checks"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Implement H5-specific quality assurance</span></span>
<span><span class="va">demonstrate_h5_quality_assurance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"HDF5 Quality Assurance and Validation:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Comprehensive H5 dataset validation\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"validate_h5_dataset &lt;- function(h5_dataset) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  validation_results &lt;- list()\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # 1. File integrity checks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cat('Checking H5 file integrity...\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  for (h5_file in h5_dataset$backend$h5_files) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    integrity_ok &lt;- check_h5_integrity(h5_file)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    validation_results[[basename(h5_file)]] &lt;- integrity_ok\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    if (!integrity_ok) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      warning('H5 file integrity issue: ', h5_file)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    }\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  }\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # 2. Compression efficiency analysis\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  compression_stats &lt;- analyze_h5_compression(h5_dataset)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cat('Average compression ratio:', compression_stats$avg_ratio, 'x\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # 3. Chunk alignment verification\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  chunk_alignment &lt;- verify_chunk_alignment(h5_dataset)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  if (!chunk_alignment$optimal) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    cat('Warning: Suboptimal chunk alignment detected\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    cat('Recommended chunk size:', chunk_alignment$recommended, '\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  }\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # 4. Metadata consistency\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  metadata_consistent &lt;- verify_h5_metadata_consistency(h5_dataset)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  validation_results$metadata_ok &lt;- metadata_consistent\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  return(validation_results)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Quality metrics specific to H5</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"H5-Specific Quality Metrics:\n"</span><span class="op">)</span></span>
<span>  <span class="va">quality_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"File integrity"</span>,</span>
<span>      <span class="st">"Compression efficiency"</span>,</span>
<span>      <span class="st">"Chunk alignment"</span>,</span>
<span>      <span class="st">"Metadata consistency"</span>,</span>
<span>      <span class="st">"Access pattern optimization"</span>,</span>
<span>      <span class="st">"Storage overhead"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    Description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"HDF5 internal structure validation"</span>,</span>
<span>      <span class="st">"Actual vs. expected compression ratios"</span>,</span>
<span>      <span class="st">"Chunk size vs. typical access patterns"</span>,</span>
<span>      <span class="st">"Spatial/temporal metadata consistency"</span>,</span>
<span>      <span class="st">"Cache hit rates and I/O patterns"</span>,</span>
<span>      <span class="st">"File size vs. raw data size"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    Good_Range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"No corruption"</span>,</span>
<span>      <span class="st">"2-4x compression"</span>,</span>
<span>      <span class="st">"&gt;80% aligned access"</span>,</span>
<span>      <span class="st">"All metadata matches"</span>,</span>
<span>      <span class="st">"&gt;70% cache hit rate"</span>,</span>
<span>      <span class="st">"&lt;120% of raw size"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">quality_metrics</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAutomated quality monitoring:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Set up automated quality checks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"schedule_h5_quality_checks &lt;- function(dataset_path) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cron_job &lt;- paste(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    '0 2 * * *',  # Daily at 2 AM\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    'Rscript check_h5_quality.R', dataset_path\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  )\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Add to system crontab for regular monitoring\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_h5_quality_assurance</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show data migration and format conversion utilities</span></span>
<span><span class="va">demonstrate_h5_migration_tools</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nH5 Migration and Conversion Tools:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Batch convert NIfTI studies to H5\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"batch_convert_study_to_h5 &lt;- function(study_dir, output_dir) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Find all NIfTI files\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  nifti_files &lt;- list.files(study_dir, pattern = '\\\\.nii(\\\\.gz)?$', \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                           recursive = TRUE, full.names = TRUE)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Create conversion plan\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  conversion_plan &lt;- create_conversion_plan(nifti_files)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Execute conversion with progress tracking\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  results &lt;- pblapply(conversion_plan, function(plan) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    convert_single_file(plan$input, plan$output, \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                       compression = plan$compression)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  })\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Generate conversion report\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  create_conversion_report(results, output_dir)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Validate converted data\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"validate_conversion &lt;- function(original_nifti, converted_h5) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Load both versions\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  nifti_data &lt;- get_data_matrix(fmri_file_dataset(original_nifti))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  h5_data &lt;- get_data_matrix(fmri_h5_dataset(converted_h5))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Compare data integrity\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  correlation &lt;- cor(as.vector(nifti_data), as.vector(h5_data))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  max_diff &lt;- max(abs(nifti_data - h5_data))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cat('Data correlation:', correlation, '\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cat('Maximum difference:', max_diff, '\\n')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Should be near-perfect for lossless compression\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  return(list(correlation = correlation, max_diff = max_diff))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Migration best practices:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Test conversion on subset first\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Validate data integrity after conversion\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Maintain original files until validation complete\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Document compression settings and rationale\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Plan storage migration strategy\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Update analysis scripts for H5 backend\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_h5_migration_tools</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="tips-and-best-practices">Tips and Best Practices<a class="anchor" aria-label="anchor" href="#tips-and-best-practices"></a>
</h2>
<p>Here are practical guidelines for working effectively with HDF5
storage in fmridataset, based on real-world experience with large
neuroimaging studies.</p>
<div class="section level3">
<h3 id="compression-configuration">Compression Configuration<a class="anchor" aria-label="anchor" href="#compression-configuration"></a>
</h3>
<p><strong>Compression Level Selection</strong>: - <strong>Level
3</strong>: Frequent data access, active analysis phase - <strong>Level
6</strong>: Balanced performance for standard workflows - <strong>Level
9</strong>: Maximum compression for archival storage</p>
<p>Compression ratios typically range from 2-4x for fMRI data, depending
on preprocessing status and data characteristics.</p>
</div>
<div class="section level3">
<h3 id="data-integrity-validation">Data Integrity Validation<a class="anchor" aria-label="anchor" href="#data-integrity-validation"></a>
</h3>
<p><strong>Required Validation Steps</strong>: 1. Execute
<code>validate_h5_dataset()</code> after file creation 2. Verify
checksums after network transfers 3. Validate structure after storage
migrations 4. Test partial data access before full analysis</p>
</div>
<div class="section level3">
<h3 id="chunk-size-optimization">Chunk Size Optimization<a class="anchor" aria-label="anchor" href="#chunk-size-optimization"></a>
</h3>
<p><strong>Access Pattern Configuration</strong>: - <strong>Temporal
analyses</strong>: Configure larger time dimension chunks (e.g., 50-100
timepoints) - <strong>Spatial analyses</strong>: Configure larger
spatial chunks (e.g., 10000+ voxels) - <strong>Mixed access</strong>:
Use balanced chunks (e.g., 20 timepoints × 5000 voxels)</p>
<p>Optimal chunk size depends on available memory and typical query
patterns.</p>
</div>
<div class="section level3">
<h3 id="storage-planning-guidelines">Storage Planning Guidelines<a class="anchor" aria-label="anchor" href="#storage-planning-guidelines"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Guidelines for H5 storage planning</span></span>
<span><span class="va">provide_storage_planning_guidance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"HDF5 Storage Planning Guidelines:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. Compression Strategy by Study Phase:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Active analysis: Level 3-6 compression\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Archive storage: Level 6-9 compression\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Sharing/transfer: Level 6+ (balance size/speed)\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. File Organization Patterns:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Small studies (&lt;50 subjects): Per-subject H5 files\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Large studies (&gt;100 subjects): Consolidated H5 by task\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Longitudinal studies: Session-based organization\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"3. Infrastructure Considerations:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Local SSD: Any compression, optimize for speed\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Network storage: Higher compression, larger chunks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Cloud storage: Maximum compression, object count critical\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"4. Access Pattern Optimization:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Frequent ROI analysis: Spatial chunking\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Time series analysis: Temporal chunking\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Mixed analysis: Balanced square chunks\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">provide_storage_planning_guidance</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Provide troubleshooting guidelines</span></span>
<span><span class="va">provide_h5_troubleshooting_guide</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nH5 Troubleshooting Guide:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Common Issues and Solutions:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. 'Cannot read H5 file' errors:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Check file permissions and path accessibility\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Verify H5 file integrity with h5dump or h5ls\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Ensure fmristore package is installed\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Check for file corruption after network transfer\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. Slow H5 access performance:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Check chunk alignment with access patterns\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Consider reducing compression level (3-6)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Enable appropriate caching strategy\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Verify storage system performance\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"3. Memory issues with H5 datasets:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Ensure preload=FALSE for large datasets\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Use smaller chunk sizes in data_chunks()\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Process data in run-wise chunks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Monitor memory usage with pryr::mem_used()\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"4. H5 file compatibility issues:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Check H5 file internal structure with h5ls\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Verify data_dataset and mask_dataset paths\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Ensure proper NeuroVec/fmristore format\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Test with h5_backend() directly\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Diagnostic commands:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Check H5 file structure\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"system('h5ls -r filename.h5')\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Verify data integrity\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"system('h5dump -n filename.h5')\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Test basic H5 operations\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"library(hdf5r)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5file &lt;- H5File$new('filename.h5', mode = 'r')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5file$ls(recursive = TRUE)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"h5file$close()\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">provide_h5_troubleshooting_guide</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="performance-optimization-strategies">Performance Optimization Strategies<a class="anchor" aria-label="anchor" href="#performance-optimization-strategies"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Advanced performance optimization for H5 datasets</span></span>
<span><span class="va">demonstrate_h5_performance_optimization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Advanced H5 Performance Optimization:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. Memory Management Strategies:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"optimize_h5_memory &lt;- function(h5_dataset, analysis_type) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  if (analysis_type == 'connectivity') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    # Spatial-focused analysis\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    config &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      preload = FALSE,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      cache_strategy = 'spatial',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      chunk_preference = 'voxel_wise'\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    )\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  } else if (analysis_type == 'temporal') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    # Time series analysis\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    config &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      preload = FALSE,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      cache_strategy = 'temporal', \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      chunk_preference = 'time_wise'\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    )\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  } else if (analysis_type == 'exploratory') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    # Mixed access patterns\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    config &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      preload = TRUE,  # Small datasets only\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      cache_strategy = 'aggressive',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      chunk_preference = 'balanced'\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    )\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  }\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  return(configure_h5_backend(h5_dataset, config))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. I/O Pattern Optimization:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Optimize chunking for specific workflows\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"optimize_chunking_for_workflow &lt;- function(h5_dataset, workflow) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  h5_info &lt;- get_h5_file_info(h5_dataset)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  if (workflow == 'group_analysis') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    # Minimize cross-subject I/O\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    chunks &lt;- data_chunks(h5_dataset, \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                         nchunks = h5_info$optimal_chunks,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                         align_with_h5 = TRUE)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  } else if (workflow == 'single_subject_detailed') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    # Optimize for complete subject processing\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    chunks &lt;- data_chunks(h5_dataset,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                         runwise = TRUE,\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                         preload_runs = TRUE)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  }\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  return(chunks)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"3. Network and Storage Optimization:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Configure for different storage systems\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"configure_for_storage_system &lt;- function(storage_type) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  if (storage_type == 'local_ssd') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    return(list(compression = 3, chunk_size = 'large'))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  } else if (storage_type == 'network_nfs') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    return(list(compression = 6, chunk_size = 'medium', \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"               cache_strategy = 'aggressive'))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  } else if (storage_type == 'cloud_object') {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    return(list(compression = 9, chunk_size = 'large',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"               minimize_requests = TRUE))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  }\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"4. Monitoring and Profiling:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Profile H5 dataset performance\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"profile_h5_performance &lt;- function(h5_dataset) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  profiling_results &lt;- list()\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Test different access patterns\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  access_patterns &lt;- c('full_load', 'run_wise', 'roi_based', 'temporal_window')\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  for (pattern in access_patterns) {\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    timing &lt;- system.time({\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"      test_access_pattern(h5_dataset, pattern)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    })\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"    profiling_results[[pattern]] &lt;- timing['elapsed']\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  }\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  # Identify optimal strategies\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  return(analyze_profiling_results(profiling_results))\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"}\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">demonstrate_h5_performance_optimization</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Provide configuration templates for common scenarios</span></span>
<span><span class="va">provide_h5_configuration_templates</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nH5 Configuration Templates:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Template 1: High-performance local analysis\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"local_analysis_config &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  compression = 3,           # Light compression for speed\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  preload = TRUE,           # If dataset fits in memory\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cache_strategy = 'aggressive',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  chunk_size = c(50, 2000), # Balanced chunks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  data_type = 'FLOAT'       # Standard precision\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Template 2: Memory-constrained analysis\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"memory_constrained_config &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  compression = 6,           # Good compression\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  preload = FALSE,          # Lazy loading\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cache_strategy = 'minimal',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  chunk_size = c(25, 1000), # Smaller chunks\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  process_runwise = TRUE    # Process runs separately\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Template 3: Archive/sharing storage\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"archive_config &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  compression = 9,           # Maximum compression\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  preload = FALSE,          # Storage-optimized\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  data_type = 'INT16',      # Reduced precision if appropriate\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  chunk_size = c(100, 5000), # Large chunks for efficiency\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  include_metadata = TRUE   # Rich metadata for sharing\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# Template 4: Cloud/HPC deployment\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"cloud_hpc_config &lt;- list(\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  compression = 6,           # Balanced for network transfer\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  preload = FALSE,          # Distributed memory\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  cache_strategy = 'distributed',\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  chunk_size = 'auto',      # Let system optimize\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  parallel_io = TRUE       # Enable parallel access\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">provide_h5_configuration_templates</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting-h5-issues">Troubleshooting H5 Issues<a class="anchor" aria-label="anchor" href="#troubleshooting-h5-issues"></a>
</h2>
<p>When working with HDF5 datasets, certain issues are common and can be
systematically diagnosed and resolved.</p>
<div class="section level3">
<h3 id="file-access-and-integrity-issues">File Access and Integrity Issues<a class="anchor" aria-label="anchor" href="#file-access-and-integrity-issues"></a>
</h3>
<dl>
<dt><strong>“Error: Cannot read H5 file”</strong></dt>
<dd>
Check file permissions, verify the file exists, and ensure fmristore is
properly installed. Use <code>h5ls filename.h5</code> to test basic file
access.
</dd>
<dt><strong>“H5 file appears corrupted”</strong></dt>
<dd>
This often occurs after network transfers. Use
<code>h5dump -n filename.h5</code> to check file structure integrity,
and consider re-transferring with checksums.
</dd>
</dl>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Diagnostic functions for H5 issues</span></span>
<span><span class="va">diagnose_h5_issues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">h5_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Diagnosing H5 file issues for:"</span>, <span class="va">h5_file</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Check basic file properties</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">h5_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"ERROR: File does not exist\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"File size:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">h5_file</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"MB\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"File permissions:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.access.html" class="external-link">file.access</a></span><span class="op">(</span><span class="va">h5_file</span>, mode <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, <span class="st">"(0 = readable)\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test H5 library access</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"hdf5r"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">h5file</span> <span class="op">&lt;-</span> <span class="fu">hdf5r</span><span class="fu">::</span><span class="va"><a href="http://hhoeflin.github.io/hdf5r/reference/H5File-class.html" class="external-link">H5File</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">h5_file</span>, mode <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span></span>
<span>        <span class="va">structure</span> <span class="op">&lt;-</span> <span class="va">h5file</span><span class="op">$</span><span class="fu">ls</span><span class="op">(</span>recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="va">h5file</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"H5 structure accessible: YES\n"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Internal groups/datasets:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">structure</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"H5 structure accessible: NO\n"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test with fmridataset</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="va">test_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fmri_h5_dataset.html">fmri_h5_dataset</a></span><span class="op">(</span><span class="va">h5_file</span>, TR <span class="op">=</span> <span class="fl">2.0</span>, run_length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"fmridataset compatibility: YES\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"fmridataset compatibility: NO\n"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># diagnose_h5_issues("problematic_scan.h5")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="performance-troubleshooting">Performance Troubleshooting<a class="anchor" aria-label="anchor" href="#performance-troubleshooting"></a>
</h3>
<dl>
<dt><strong>Slow H5 data access</strong></dt>
<dd>
Check if chunk sizes align with your access patterns, consider reducing
compression level, and verify storage system performance.
</dd>
<dt><strong>High memory usage with H5 datasets</strong></dt>
<dd>
Ensure <code>preload=FALSE</code> for large datasets, use smaller chunk
sizes, and process data run-wise rather than loading entire datasets.
</dd>
</dl>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Performance troubleshooting for H5 datasets</span></span>
<span><span class="va">troubleshoot_h5_performance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">h5_dataset</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"H5 Performance Troubleshooting:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Check dataset configuration</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. Dataset Configuration:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   Preload setting:"</span>, <span class="va">h5_dataset</span><span class="op">$</span><span class="va">backend</span><span class="op">$</span><span class="va">preload</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   Cache strategy:"</span>, <span class="va">h5_dataset</span><span class="op">$</span><span class="va">backend</span><span class="op">$</span><span class="va">cache_strategy</span> <span class="op"><a href="../reference/grapes-or-or-grapes.html">%||%</a></span> <span class="st">"default"</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Estimate memory usage</span></span>
<span>  <span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_data_matrix.html">get_data_matrix</a></span><span class="op">(</span><span class="va">h5_dataset</span>, run_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">estimated_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">dims</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span> <span class="op">/</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span> <span class="co"># Assume 4 bytes per float</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   Estimated memory per run:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">estimated_size</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"MB\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Test access patterns</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. Access Pattern Performance:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"microbenchmark"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu">microbenchmark</span><span class="op">(</span></span>
<span>      single_run <span class="op">=</span> <span class="fu"><a href="../reference/get_data_matrix.html">get_data_matrix</a></span><span class="op">(</span><span class="va">h5_dataset</span>, run_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      small_chunk <span class="op">=</span> <span class="op">{</span></span>
<span>        <span class="va">chunks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_chunks.html">data_chunks</a></span><span class="op">(</span><span class="va">h5_dataset</span>, nchunks <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>        <span class="va">chunks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span></span>
<span>      <span class="op">}</span>,</span>
<span>      times <span class="op">=</span> <span class="fl">3</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mb</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Recommendations</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n3. Optimization Recommendations:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">estimated_size</span> <span class="op">&gt;</span> <span class="fl">500</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Large dataset detected: Use chunked processing\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Consider preload=FALSE and smaller chunk sizes\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">h5_dataset</span><span class="op">$</span><span class="va">backend</span><span class="op">$</span><span class="va">preload</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Preloading enabled: Good for repeated access\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"   - Lazy loading: Good for memory efficiency\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># troubleshoot_h5_performance(h5_dataset)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="integration-with-other-vignettes">Integration with Other Vignettes<a class="anchor" aria-label="anchor" href="#integration-with-other-vignettes"></a>
</h2>
<p>This HDF5 storage guide connects to several other aspects of the
fmridataset ecosystem:</p>
<p><strong>Prerequisites</strong>: Start with <a href="fmridataset-intro.html">Getting Started</a> to understand the
basic dataset interface before exploring H5-specific features.</p>
<p><strong>Architecture Understanding</strong>: The <a href="architecture-overview.html">Architecture Overview</a> explains how
H5 backends fit into the overall storage abstraction system.</p>
<p><strong>Scaling Applications</strong>: - <a href="study-level-analysis.html">Study-Level Analysis</a> - H5 storage
provides significant advantages for large multi-subject studies - <a href="backend-registry.html">Backend Registry</a> - See how H5 backends
integrate with the pluggable storage system</p>
<p><strong>Advanced Development</strong>: <a href="extending-backends.html">Extending Backends</a> shows how to
create custom H5-based backends for specialized storage needs.</p>
<p><strong>Ecosystem Integration</strong>: H5 datasets work seamlessly
with the broader neuroimaging ecosystem: - <strong>fmristore</strong>:
Provides the underlying H5 neuroimaging format -
<strong>neuroim2</strong>: NeuroVec objects can be stored and loaded
from H5 format - <strong>DelayedArray</strong>: Advanced lazy evaluation
for memory-efficient operations - <strong>BiocParallel</strong>:
Efficient parallel processing of H5-stored data</p>
</div>
<div class="section level2">
<h2 id="session-information">Session Information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
