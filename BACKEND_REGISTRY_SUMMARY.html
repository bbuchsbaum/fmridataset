<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Backend Registry System Implementation • fmridataset</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Backend Registry System Implementation"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">fmridataset</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/architecture-overview.html">Architecture Deep Dive: Design Principles and Extensibility</a></li>
    <li><a class="dropdown-item" href="articles/backend-development-basics.html">Backend Development Basics: Creating Custom Storage Backends</a></li>
    <li><a class="dropdown-item" href="articles/backend-registry.html">Backend Registry: Extending Data Format Support</a></li>
    <li><a class="dropdown-item" href="articles/extending-backends.html">Advanced Backend Development: Storage Extensions</a></li>
    <li><a class="dropdown-item" href="articles/fmridataset-intro.html">Getting Started with fmridataset</a></li>
    <li><a class="dropdown-item" href="articles/h5-backend-usage.html">HDF5 Storage: High-Performance Data Management for Large-Scale fMRI Studies</a></li>
    <li><a class="dropdown-item" href="articles/study-level-analysis.html">Scaling to Study-Level Analysis: From Single Subjects to Group Studies</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmridataset/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Backend Registry System Implementation</h1>
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmridataset/blob/main/BACKEND_REGISTRY_SUMMARY.md" class="external-link"><code>BACKEND_REGISTRY_SUMMARY.md</code></a></small>
    </div>

<div id="backend-registry-system-implementation" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>I have successfully implemented a comprehensive backend registry system for the fmridataset R package. This system makes backends pluggable via a registry pattern instead of hardcoding types, allowing external packages to register new backends without modifying fmridataset.</p>
</div>
<div class="section level2">
<h2 id="what-was-implemented">What Was Implemented<a class="anchor" aria-label="anchor" href="#what-was-implemented"></a></h2>
<div class="section level3">
<h3 id="id_1-core-registry-system-rbackend_registryr">1. Core Registry System (<code>R/backend_registry.R</code>)<a class="anchor" aria-label="anchor" href="#id_1-core-registry-system-rbackend_registryr"></a></h3>
<ul><li>
<strong>Registry Environment</strong>: Package-level environment to store backend registrations</li>
<li>
<strong>Registration Functions</strong>:
<ul><li>
<code><a href="reference/register_backend.html">register_backend()</a></code>: Register new backend types</li>
<li>
<code><a href="reference/unregister_backend.html">unregister_backend()</a></code>: Remove backend types</li>
<li>
<code><a href="reference/is_backend_registered.html">is_backend_registered()</a></code>: Check registration status</li>
<li>
<code><a href="reference/get_backend_registry.html">get_backend_registry()</a></code>: Get registry information</li>
<li>
<code><a href="reference/list_backend_names.html">list_backend_names()</a></code>: List all registered backends</li>
</ul></li>
<li>
<strong>Backend Creation</strong>: <code><a href="reference/create_backend.html">create_backend()</a></code> - Create backend instances by name</li>
<li>
<strong>Validation</strong>: Enhanced validation system with backend-specific validation functions</li>
</ul></div>
<div class="section level3">
<h3 id="id_2-enhanced-backend-validation-rstorage_backendr">2. Enhanced Backend Validation (<code>R/storage_backend.R</code>)<a class="anchor" aria-label="anchor" href="#id_2-enhanced-backend-validation-rstorage_backendr"></a></h3>
<ul><li>Added class inheritance checking</li>
<li>Added S3 method availability checking</li>
<li>Better error messages for missing implementations</li>
<li>Support for custom validation functions per backend type</li>
</ul></div>
<div class="section level3">
<h3 id="id_3-integration-with-existing-code">3. Integration with Existing Code<a class="anchor" aria-label="anchor" href="#id_3-integration-with-existing-code"></a></h3>
<ul><li>Modified <code>R/dataset_constructors.R</code> to use registry system</li>
<li>Updated <code>R/zzz.R</code> to register built-in backends on package load</li>
<li>Maintained full backward compatibility</li>
</ul></div>
<div class="section level3">
<h3 id="id_4-built-in-backend-registration">4. Built-in Backend Registration<a class="anchor" aria-label="anchor" href="#id_4-built-in-backend-registration"></a></h3>
<p>All existing backends are automatically registered: - <code>nifti</code>: NIfTI format backend using neuroim2 - <code>h5</code>: HDF5 format backend using fmristore<br>
- <code>matrix</code>: In-memory matrix backend - <code>latent</code>: Latent space backend for dimension-reduced data - <code>study</code>: Multi-subject study backend - <code>zarr</code>: Zarr format backend</p>
</div>
<div class="section level3">
<h3 id="id_5-documentation-and-examples">5. Documentation and Examples<a class="anchor" aria-label="anchor" href="#id_5-documentation-and-examples"></a></h3>
<ul><li>
<strong>Vignette</strong>: <code>vignettes/backend-registry.Rmd</code> - Comprehensive guide on creating custom backends</li>
<li>
<strong>Example Code</strong>: <code>examples/backend_registry_example.R</code> - Working examples of custom backends</li>
<li>
<strong>Documentation</strong>: Full roxygen2 documentation for all new functions</li>
</ul></div>
<div class="section level3">
<h3 id="id_6-comprehensive-testing">6. Comprehensive Testing<a class="anchor" aria-label="anchor" href="#id_6-comprehensive-testing"></a></h3>
<ul><li>
<strong>Unit Tests</strong>: <code>tests/testthat/test_backend_registry.R</code> - 76 tests covering all registry functionality</li>
<li>
<strong>Integration Tests</strong>: <code>tests/testthat/test_backend_registry_integration.R</code> - 31 tests verifying integration with existing code</li>
<li>All tests pass successfully</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a></h2>
<div class="section level3">
<h3 id="extensibility">Extensibility<a class="anchor" aria-label="anchor" href="#extensibility"></a></h3>
<ul><li>External packages can register new backends without modifying fmridataset</li>
<li>Simple registration API: <code>register_backend(name, factory, description)</code>
</li>
<li>Support for custom validation functions</li>
</ul></div>
<div class="section level3">
<h3 id="backward-compatibility">Backward Compatibility<a class="anchor" aria-label="anchor" href="#backward-compatibility"></a></h3>
<ul><li>All existing code continues to work unchanged</li>
<li>Direct backend constructor calls still work</li>
<li>Existing dataset constructors enhanced to use registry internally</li>
</ul></div>
<div class="section level3">
<h3 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a></h3>
<ul><li>Comprehensive validation of backend contracts</li>
<li>Clear error messages for missing implementations</li>
<li>Custom validation functions for backend-specific requirements</li>
</ul></div>
<div class="section level3">
<h3 id="discoverability">Discoverability<a class="anchor" aria-label="anchor" href="#discoverability"></a></h3>
<ul><li>
<code><a href="reference/list_backend_names.html">list_backend_names()</a></code> shows all available backends</li>
<li>
<code><a href="reference/get_backend_registry.html">get_backend_registry()</a></code> provides detailed information</li>
<li>Print method for pretty-printed registry information</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="usage-examples">Usage Examples<a class="anchor" aria-label="anchor" href="#usage-examples"></a></h2>
<div class="section level3">
<h3 id="basic-backend-registration">Basic Backend Registration<a class="anchor" aria-label="anchor" href="#basic-backend-registration"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Register a custom backend</span></span>
<span><span class="va">my_backend_factory</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">source</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Implementation here</span></span>
<span>  <span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">source</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_backend"</span>, <span class="st">"storage_backend"</span><span class="op">)</span></span>
<span>  <span class="va">backend</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/register_backend.html">register_backend</a></span><span class="op">(</span><span class="st">"my_backend"</span>, <span class="va">my_backend_factory</span>, <span class="st">"My custom backend"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create instance</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_backend.html">create_backend</a></span><span class="op">(</span><span class="st">"my_backend"</span>, source <span class="op">=</span> <span class="st">"data.txt"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-in-dataset-creation">Using in Dataset Creation<a class="anchor" aria-label="anchor" href="#using-in-dataset-creation"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create backend and use in dataset</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_backend.html">create_backend</a></span><span class="op">(</span><span class="st">"nifti"</span>, </span>
<span>                         source <span class="op">=</span> <span class="st">"scan.nii"</span>, </span>
<span>                         mask_source <span class="op">=</span> <span class="st">"mask.nii"</span><span class="op">)</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fmri_dataset.html">fmri_dataset</a></span><span class="op">(</span><span class="va">backend</span>, TR <span class="op">=</span> <span class="fl">2</span>, run_length <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="package-integration">Package Integration<a class="anchor" aria-label="anchor" href="#package-integration"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In external package's .onLoad()</span></span>
<span><span class="va">.onLoad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">libname</span>, <span class="va">pkgname</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"fmridataset"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">fmridataset</span><span class="fu">::</span><span class="fu"><a href="reference/register_backend.html">register_backend</a></span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="st">"myformat"</span>,</span>
<span>      factory <span class="op">=</span> <span class="va">myformat_backend</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Backend for MyFormat files"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="benefits">Benefits<a class="anchor" aria-label="anchor" href="#benefits"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Pluggable Architecture</strong>: External packages can extend functionality without core changes</li>
<li>
<strong>Type Safety</strong>: Strong validation ensures backends implement required contracts</li>
<li>
<strong>Discoverability</strong>: Easy to find and use available backends</li>
<li>
<strong>Maintainability</strong>: Centralized registration system vs scattered hardcoded types</li>
<li>
<strong>Future-Proof</strong>: Easy to add new backends as data formats evolve</li>
</ol></div>
<div class="section level2">
<h2 id="files-addedmodified">Files Added/Modified<a class="anchor" aria-label="anchor" href="#files-addedmodified"></a></h2>
<div class="section level3">
<h3 id="new-files">New Files<a class="anchor" aria-label="anchor" href="#new-files"></a></h3>
<ul><li>
<code>R/backend_registry.R</code> - Core registry system</li>
<li>
<code>tests/testthat/test_backend_registry.R</code> - Registry unit tests</li>
<li>
<code>tests/testthat/test_backend_registry_integration.R</code> - Integration tests</li>
<li>
<code>vignettes/backend-registry.Rmd</code> - User guide</li>
<li>
<code>examples/backend_registry_example.R</code> - Working examples</li>
</ul></div>
<div class="section level3">
<h3 id="modified-files">Modified Files<a class="anchor" aria-label="anchor" href="#modified-files"></a></h3>
<ul><li>
<code>R/zzz.R</code> - Register built-in backends on load</li>
<li>
<code>R/dataset_constructors.R</code> - Use registry for backend creation</li>
<li>
<code>R/storage_backend.R</code> - Enhanced validation</li>
<li>
<code>NAMESPACE</code> - Export new functions (auto-generated by roxygen2)</li>
</ul><p>The implementation successfully meets all requirements: ✅ Registry system for backend registration<br>
✅ Backends discoverable by name/type<br>
✅ External package registration support<br>
✅ Backward compatibility maintained<br>
✅ Interface validation<br>
✅ Documentation and examples<br>
✅ Comprehensive testing<br>
✅ R best practices integration</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

